<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AI Rapportagecontrole</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --bg-light: linear-gradient(to bottom right, #f0f8ff, #eaf6ff);
      --bg-dark: #121212;
      --text-light: #333;
      --text-dark: #eee;
      --container-bg-light: #ffffff;
      --container-bg-dark: #1e1e1e;
      --primary: #007bff;
      --primary-hover: #1976D2;
      --danger: #dc3545;
      --success: #28a745;
      --warning: #ffc107;
      --info: #00BCD4;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      min-height: 100vh;
      padding: 1rem;
      transition: background 0.3s, color 0.3s;
    }

    body.dark-mode {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    .container {
      background: var(--container-bg-light);
      padding: 1.5rem;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      transition: background 0.3s;
    }

    body.dark-mode .container {
      background: var(--container-bg-dark);
    }

    .header-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }

    .header-buttons .btn {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      background: transparent;
      color: var(--text-light);
    }

    body.dark-mode .header-buttons .btn {
      color: var(--text-dark);
    }

    .header-buttons .btn:hover {
      transform: translateY(-1px);
      opacity: 0.8;
    }

    .header-buttons .btn .material-icons {
      font-size: 1.1rem;
    }

    /* Mobiele weergave van de knoppen */
    @media (max-width: 768px) {
      .header-buttons {
        position: relative;
        top: 0;
        right: 0;
        justify-content: center;
        margin-bottom: 1.5rem;
      }

      .header-buttons .btn {
        padding: 0.6rem 1rem;
        background: var(--primary);
        color: white;
        border-radius: 8px;
        min-width: 120px;
        justify-content: center;
      }

      body.dark-mode .header-buttons .btn {
        color: white;
      }
    }

    .dark-icon, .light-icon {
      font-size: 1.1rem;
      margin-right: 0.25rem;
    }

    /* Desktop weergave van dark/light iconen */
    @media (min-width: 769px) {
      .dark-icon, .light-icon {
        margin-right: 0.25rem;
      }
    }

    /* Mobiele weergave van dark/light iconen */
    @media (max-width: 768px) {
      .dark-icon, .light-icon {
        margin-right: 0.5rem;
      }
    }

    /* Dark mode icoon weergave */
    .dark-icon {
      display: inline;
    }
    
    .light-icon {
      display: none;
    }

    /* Light mode icoon in dark mode */
    body.dark-mode .dark-icon {
      display: none;
    }

    body.dark-mode .light-icon {
      display: inline;
    }

    @media (max-width: 768px) {
      .header-buttons {
        position: relative;
        top: 0;
        right: 0;
        justify-content: center;
        margin-bottom: 1.5rem;
      }
    }

    h1 {
      color: var(--primary);
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .subtitle {
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .btn-group button {
      margin-right: 0;
      flex: 1 1 200px;
      min-width: 200px;
      max-width: 300px;
      position: relative;
    }

    /* Styling voor sneltoetsen */
    .btn-group button kbd {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8em;
      font-family: monospace;
      pointer-events: none;
    }

    /* Zorg dat de tekst niet overlapt met de sneltoets */
    .btn-group button span {
      margin-right: 50px;
      display: inline-block;
    }

    textarea {
      width: 100%;
      height: 150px;
      padding: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      resize: vertical;
    }

    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      .container {
        padding: 1rem;
        border-radius: 12px;
      }

      h1 {
        font-size: 1.5rem;
      }

      .header-buttons {
        justify-content: center;
      }

      .btn-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }

      textarea {
        height: 120px;
      }
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 1rem;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
      box-sizing: border-box;
    }

    body.dark-mode {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    .container {
      position: relative;
      background: var(--container-bg-light);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      width: calc(100% - 2rem);
      margin: 0 auto;
      transition: background 0.3s;
      box-sizing: border-box;
    }

    body.dark-mode .container {
      background: var(--container-bg-dark);
    }

    h1 {
      color: var(--primary);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: inherit;
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-top: 1.5rem;
      font-weight: 600;
    }

    .input-wrapper {
      position: relative;
      margin-top: 0.5rem;
    }

    .clear-btn {
      position: absolute;
      right: 10px;
      top: 10px;
      background: rgba(0,0,0,0.1);
      color: #666;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      opacity: 0.7;
      transition: opacity 0.2s, background 0.2s;
    }

    .clear-btn:hover {
      opacity: 1;
      background: rgba(0,0,0,0.15);
    }

    body.dark-mode .clear-btn {
      background: rgba(255,255,255,0.1);
      color: #ddd;
    }

    body.dark-mode .clear-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    textarea {
      width: 100%;
      height: 160px;
      padding: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      resize: vertical;
      box-sizing: border-box;
    }

    select, button {
      margin-top: 0.5rem;
      padding: 0.6rem 1.2rem;
      font-size: 0.95rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    select {
      background-color: #f5f5f5;
      width: 100%;
      max-width: 100%;
    }

    button {
      padding: 0.6rem 1.2rem;
      font-size: 0.95rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background-color: var(--primary);
      color: #333;
      transition: background 0.3s, transform 0.2s;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .btn-group button {
      margin-right: 0;
      flex: 1 0 auto;
      min-width: fit-content;
    }

    .btn-success {
      background-color: var(--success);
    }

    .btn-success:hover {
      background-color: #1b5e20;
    }

    .btn-danger {
      background-color: var(--danger);
    }

    .btn-danger:hover {
      background-color: #b71c1c;
    }

    .btn-warning {
      background-color: var(--warning);
    }

    .btn-warning:hover {
      background-color: #e65100;
    }

    .btn-sm {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
    }

    .btn-circle {
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon {
      margin-right: 0.5rem;
    }

    .dark-toggle {
      font-size: 0.9rem;
      color: #333;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      height: 38px;
      min-width: 120px;
      justify-content: center;
      background: linear-gradient(45deg, #FFB300, #FFA000);
    }

    .dark-toggle:hover {
      background: linear-gradient(45deg, #FFA000, #FF8F00);
    }

    body.dark-mode .dark-toggle .light-icon {
      display: inline;
    }

    body.dark-mode .dark-toggle .dark-icon {
      display: none;
    }

    .dark-toggle .light-icon {
      display: none;
    }

    .dark-toggle .dark-icon {
      display: inline;
    }

    pre {
      background: #f9f9f9;
      padding: 1rem;
      white-space: pre-wrap;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 1rem;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
    }

    body.dark-mode pre {
      background: #2a2a2a;
      border-color: #444;
      color: #ddd;
    }

    /* Info melding styling */
    .info {
      background: #fff3d6;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-left: 6px solid #FFB300;
      border-radius: 8px;
      color: #664d03;
      animation: fadeOut 0.5s ease-in-out 10s forwards;
      position: relative;
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: translateY(0);
        margin-bottom: 1.5rem;
        padding: 1rem;
        height: auto;
      }
      to {
        opacity: 0;
        transform: translateY(-20px);
        margin-bottom: 0;
        padding: 0;
        height: 0;
      }
    }

    body.dark-mode .info {
      background: rgba(255, 179, 0, 0.1);
      border-left-color: #FFB300;
      color: #FFD740;
    }

    .uitleg {
      font-size: 0.9rem;
      color: #555;
      margin-top: 0.5rem;
    }

    body.dark-mode .uitleg {
      color: #aaa;
    }

    .recording-active {
      background-color: var(--danger) !important;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
      100% {
        opacity: 1;
      }
    }

    .recording-indicator {
      display: none;
      align-items: center;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--danger);
      background: rgba(220, 38, 38, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      gap: 0.5rem;
    }

    .recording-indicator.active {
      display: inline-flex;
    }

    .recording-deelnemer {
      font-weight: bold;
      margin-left: 0.5rem;
    }

    .recording-dot {
      height: 10px;
      width: 10px;
      background-color: var(--danger);
      border-radius: 50%;
      display: inline-block;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    /* Responsieve stijlen voor mobiele apparaten */
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      .container {
        padding: 1rem;
        border-radius: 12px;
        width: calc(100% - 1rem);
        margin: 0 auto;
      }

      h1 {
        font-size: 1.5rem;
        margin-top: 2.5rem;
      }

      .header-buttons {
        position: relative;
        top: 0;
        right: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
        justify-content: center;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn-group button {
        width: 100%;
      }

      textarea {
        height: 120px;
      }

      /* Verbeterde tekstinvoer voor mobiel */
      #input {
        font-size: 16px; /* Voorkomt inzoomen op iOS */
        padding: 12px;
        min-height: 120px;
        -webkit-appearance: none; /* Voorkomt iOS styling */
        border-radius: 8px;
      }

      /* Maak opnameknoppen groter en beter klikbaar op mobiel */
      .btn-group button {
        min-height: 44px; /* Minimale Apple-richtlijn voor touch targets */
        padding: 12px 16px;
        margin: 4px 0;
        width: 100%;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Verbeterde opname-indicator voor mobiel */
      .recording-indicator {
        padding: 8px 12px;
        border-radius: 20px;
        background: rgba(220, 38, 38, 0.1);
        margin: 8px 0;
      }

      .recording-indicator.active {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      /* Verbeterde feedback tijdens opname */
      .recording-active {
        background-color: var(--danger) !important;
        box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.2);
      }

      /* Voorkom dat het toetsenbord de opnameknoppen verbergt */
      .btn-group {
        position: sticky;
        bottom: 0;
        background: var(--container-bg-light);
        padding: 8px 0;
        z-index: 100;
        margin: 0;
        border-top: 1px solid rgba(0,0,0,0.1);
      }

      body.dark-mode .btn-group {
        background: var(--container-bg-dark);
        border-top-color: rgba(255,255,255,0.1);
      }
    }

    /* Verbeterde touch feedback */
    @media (hover: none) {
      .btn:active {
        transform: scale(0.98);
        opacity: 0.9;
      }

      textarea:focus {
        box-shadow: 0 0 0 2px var(--primary);
      }
    }

    .privacy-tip {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #1a73e8;
      display: flex;
      align-items: center;
    }

    .privacy-tip svg {
      width: 16px;
      height: 16px;
      margin-right: 6px;
      fill: currentColor;
    }

    body.dark-mode .privacy-tip {
      color: #64b5f6;
    }

    .footer {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid #ddd;
      text-align: center;
      font-size: 0.85rem;
      color: #666;
    }

    .footer-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .copyright {
      width: 100%;
      text-align: center;
    }

    .donate-section {
      width: 100%;
      display: flex;
      justify-content: center;
      position: relative;
    }

    .donate-button {
      font-size: 0.9rem;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      background: linear-gradient(45deg, #FFD700, #FFA000) !important;
      color: #333 !important;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      font-weight: 600;
    }

    .donate-button:hover {
      transform: translateY(-2px);
      background: linear-gradient(45deg, #FFA000, #FF8F00) !important;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .donatie-menu {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      padding: 0.5rem;
      display: none;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      min-width: 200px;
      z-index: 1000;
    }

    body.dark-mode .donatie-menu {
      background: #2a2a2a;
      box-shadow: 0 3px 10px rgba(0,0,0,0.4);
    }

    .donate-option {
      width: 100%;
      text-align: left;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s ease;
      border: none;
      border-radius: 6px;
      background: transparent;
      color: var(--text-light);
    }

    body.dark-mode .donate-option {
      color: var(--text-dark);
    }

    .donate-option:hover {
      background: rgba(255, 215, 0, 0.1);
      transform: translateX(5px);
    }

    body.dark-mode .donate-option:hover {
      background: rgba(255, 215, 0, 0.2);
    }

    @media (max-width: 768px) {
      .footer-content {
        padding: 0 1rem;
      }
    }

    /* Toegankelijkheid en focus stijlen */
    button:focus, select:focus, textarea:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    /* Loading indicator */
    .loading {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Help tooltip voor SOEP */
    .help-tooltip {
      position: relative;
      display: inline-flex;
      margin-left: 8px;
      width: 18px;
      height: 18px;
      background: #e0e0e0;
      color: #333;
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      cursor: help;
    }

    .tooltip-content {
      position: absolute;
      left: 25px;
      top: -5px;
      width: 250px;
      background: white;
      color: #333;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      font-weight: normal;
      z-index: 100;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s, visibility 0.3s;
      text-align: left;
      font-size: 0.85rem;
    }

    .help-tooltip:hover .tooltip-content,
    .help-tooltip:focus .tooltip-content {
      visibility: visible;
      opacity: 1;
    }

    body.dark-mode .help-tooltip {
      background: #444;
      color: #eee;
    }

    body.dark-mode .tooltip-content {
      background: #333;
      color: #eee;
    }

    /* Snelkoppeling hints tonen */
    .shortcut-hint {
      opacity: 0.7;
      font-size: 0.75rem;
      margin-left: 6px;
      padding: 2px 5px;
      background: rgba(0,0,0,0.1);
      border-radius: 3px;
    }

    body.dark-mode .shortcut-hint {
      background: rgba(255,255,255,0.1);
    }

    /* Deelnemer interface styling */
    .deelnemer-section {
      margin: 1.5rem 0;
      padding: 1.2rem;
      background: linear-gradient(to bottom right, #fff9e6, #fff3d6);
      border-radius: 12px;
      border: 1px solid rgba(255, 179, 0, 0.2);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      overflow: hidden; /* Voorkom dat content buiten de container valt */
    }

    .deelnemer-controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
    }

    .action-groups-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      width: 100%;
    }

    .action-group {
      flex: 1;
      min-width: 200px;
      display: flex;
      gap: 0.5rem;
    }

    .action-group button {
      flex: 1;
      height: 38px;
      padding: 0.5rem;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      white-space: nowrap;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .action-group button .material-icons {
      font-size: 18px;
    }

    /* Responsieve aanpassingen voor verschillende schermgroottes */
    @media (min-width: 1024px) {
      .action-groups-container {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .deelnemer-section {
        padding: 1rem;
      }

      .action-groups-container {
        grid-template-columns: 1fr;
      }

      .action-group button {
        height: 44px;
        font-size: 1rem;
      }

      .action-group button .material-icons {
        font-size: 20px;
      }
    }

    /* Verbeterde button styling */
    .action-group .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .action-group .btn-warning {
      background-color: var(--warning);
      color: white;
    }

    .action-group .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .action-group .btn-success {
      background-color: var(--success);
      color: white;
    }

    .action-group button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .action-group button:active {
      transform: translateY(0);
    }

    .deelnemer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .deelnemer-header h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
    }

    body.dark-mode .deelnemer-header h3 {
      color: #ffffff;
    }

    .deelnemer-select {
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .deelnemer-select select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }

    .deelnemer-actions {
      display: flex;
      gap: 0.75rem;
      flex: 1;
      justify-content: flex-end;
    }

    .deelnemer-actions .btn {
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      height: 38px;
      min-width: 38px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .deelnemer-actions .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .action-group {
      display: flex;
      gap: 0.5rem;
    }

    @media (max-width: 768px) {
      .deelnemer-section {
        margin: 1rem -0.5rem;
        padding: 1rem;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.05);
      }

      .deelnemer-controls {
        flex-direction: column;
        gap: 1rem;
      }

      .deelnemer-select select {
        width: 100%;
        padding: 12px;
        font-size: 1rem;
        border-radius: 8px;
        background-color: var(--container-bg-light);
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      body.dark-mode .deelnemer-select select {
        background-color: var(--container-bg-dark);
        border-color: rgba(255, 255, 255, 0.1);
        color: var(--text-dark);
      }

      .action-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        width: 100%;
      }

      .action-group button {
        width: 100%;
        min-height: 48px;
        padding: 0.75rem;
        font-size: 0.95rem;
        border-radius: 8px;
        transition: transform 0.2s, background-color 0.2s;
      }

      .action-group button:active {
        transform: scale(0.98);
      }

      .action-group .material-icons {
        font-size: 1.4rem;
        margin-right: 6px;
      }

      /* Verbeterde focus states */
      .btn:focus-visible {
        outline: 3px solid var(--primary);
        outline-offset: 2px;
      }
    }

    .donate-section {
      position: relative;
    }

    .donate-button {
      font-size: 0.9rem;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      background: linear-gradient(45deg, #FFD700, #FFA000) !important;
      color: #333 !important;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      font-weight: 600;
    }

    .donate-button:hover {
      transform: translateY(-2px);
      background: linear-gradient(45deg, #FFA000, #FF8F00) !important;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .donatie-menu {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      padding: 0.5rem;
      display: none;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      min-width: 200px;
      z-index: 1000;
    }

    body.dark-mode .donatie-menu {
      background: #2a2a2a;
      box-shadow: 0 3px 10px rgba(0,0,0,0.4);
    }

    .donate-option {
      width: 100%;
      text-align: left;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s ease;
      border: none;
      border-radius: 6px;
      background: transparent;
      color: var(--text-light);
    }

    body.dark-mode .donate-option {
      color: var(--text-dark);
    }

    .donate-option:hover {
      background: rgba(255, 215, 0, 0.1);
      transform: translateX(5px);
    }

    body.dark-mode .donate-option:hover {
      background: rgba(255, 215, 0, 0.2);
    }

    @media (max-width: 768px) {
      .footer-content {
        padding: 0 1rem;
      }
    }

    /* Offline status indicator */
    .offline-indicator {
      display: none;
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: #f44336;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      align-items: center;
      gap: 0.5rem;
    }

    body.offline .offline-indicator {
      display: flex;
    }

    /* Voeg deze stijlen toe voor de notificaties */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .notification {
      background: white;
      color: #333;
      padding: 12px 24px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 8px;
      animation: slideIn 0.3s ease-out;
      max-width: 300px;
      border-left: 4px solid var(--primary);
    }

    .notification.success {
      border-left-color: var(--success);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    body.dark-mode .notification {
      background: #2a2a2a;
      color: #fff;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    /* Dark mode aanpassingen voor deelnemers sectie */
    body.dark-mode .deelnemer-section {
      background: linear-gradient(to bottom right, rgba(255, 179, 0, 0.1), rgba(255, 179, 0, 0.05));
      border-color: rgba(255, 179, 0, 0.3);
    }

    body.dark-mode .deelnemer-select select {
      background-color: var(--container-bg-dark);
      border-color: rgba(255, 255, 255, 0.1);
      color: var(--text-dark);
    }

    body.dark-mode .action-group button {
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    body.dark-mode .action-group .btn-primary {
      background-color: var(--primary);
    }

    body.dark-mode .action-group .btn-warning {
      background-color: var(--warning);
    }

    body.dark-mode .action-group .btn-danger {
      background-color: var(--danger);
    }

    body.dark-mode .action-group .btn-success {
      background-color: var(--success);
    }

    /* Observatie knoppen styling */
    .observatie-knoppen {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
    }

    .opname-knoppen {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      min-width: 200px;
    }

    .ai-knoppen {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      flex: 1;
    }

    .ai-knoppen .full-width {
      grid-column: 1 / -1;
    }

    .ai-knoppen button {
      height: 38px;
      padding: 0.5rem;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: 6px;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    /* Specifieke knop styling */
    .ai-knoppen .btn-chatgpt {
      background-color: #10a37f; /* ChatGPT groen */
      color: white;
    }

    .ai-knoppen .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .ai-knoppen .btn-warning {
      background-color: var(--warning);
      color: white;
    }

    .ai-knoppen button:hover {
      transform: translateY(-1px);
      filter: brightness(110%);
    }

    @media (max-width: 768px) {
      .ai-knoppen {
        grid-template-columns: 1fr;
      }

      .ai-knoppen button {
        height: 44px;
        font-size: 1rem;
      }
    }

    /* Backup sectie styling */
    .backup-section {
      margin: 1rem 0;
      padding: 1rem;
      background: linear-gradient(to bottom right, #e3f2fd, #bbdefb);
      border-radius: 12px;
      border: 1px solid rgba(33, 150, 243, 0.2);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .backup-header {
      margin-bottom: 1rem;
    }

    .backup-header h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
    }

    .backup-controls {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .backup-controls button {
      flex: 1;
      min-width: 200px;
      height: 38px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    /* Dark mode aanpassingen voor backup sectie */
    body.dark-mode .backup-section {
      background: linear-gradient(to bottom right, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
      border-color: rgba(33, 150, 243, 0.3);
    }

    body.dark-mode .backup-header h3 {
      color: #64b5f6;
    }

    @media (max-width: 768px) {
      .backup-section {
        padding: 0.75rem;
      }

      .backup-controls button {
        width: 100%;
        height: 44px;
      }
    }

    /* Toevoegen van een deelnemer-vereist melding */
    .deelnemer-required-message {
      display: none;
      background-color: #fff3cd;
      color: #664d03;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      border-left: 4px solid #ffc107;
      font-weight: 500;
      align-items: center;
      gap: 0.5rem;
    }

    body.dark-mode .deelnemer-required-message {
      background-color: rgba(255, 193, 7, 0.1);
      color: #ffc107;
    }

    .deelnemer-required-message.visible {
      display: flex;
    }

    .input-disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Aanpassing van genereer knoppen bij geen deelnemer */
    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Voeg deze CSS toe aan de bestaande styles sectie */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    .overlay-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      position: relative;
    }

    body.dark-mode .overlay-content {
      background: #2a2a2a;
      color: white;
    }

    .overlay-text {
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .overlay-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .overlay-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }

    body.dark-mode .overlay-close {
      color: #999;
    }

    .copy-status {
      margin-top: 1rem;
      font-weight: bold;
      color: var(--success);
    }

    /* Voeg deze CSS toe bij de andere button styles */
    .btn-copy {
      background-color: #FF9800 !important; /* Oranje kleur */
      color: white !important;
    }

    .btn-copy:hover {
      background-color: #F57C00 !important;
    }

    body.dark-mode .btn-copy {
      background-color: #FB8C00 !important;
    }

    body.dark-mode .btn-copy:hover {
      background-color: #EF6C00 !important;
    }

    /* Voeg deze CSS toe voor de help modal */
    .help-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      justify-content: center;
      align-items: start;
      padding: 2rem;
      overflow-y: auto;
    }

    .help-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 800px;
      width: 90%;
      position: relative;
      margin: auto;
      max-height: 90vh;
      overflow-y: auto;
    }

    body.dark-mode .help-modal-content {
      background: #2a2a2a;
      color: #fff;
    }

    .help-modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
      padding: 0.5rem;
      line-height: 1;
    }

    body.dark-mode .help-modal-close {
      color: #aaa;
    }

    .help-modal-close:hover {
      color: #333;
    }

    body.dark-mode .help-modal-close:hover {
      color: #fff;
    }

    .help-section {
      margin-bottom: 2rem;
    }

    .help-section h2 {
      color: var(--primary);
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }

    .help-section ul {
      list-style: none;
      padding-left: 1.5rem;
    }

    .help-section li {
      margin-bottom: 0.5rem;
      position: relative;
    }

    .help-section li::before {
      content: "•";
      color: var(--primary);
      position: absolute;
      left: -1.5rem;
    }

    .help-subsection {
      margin-left: 1.5rem;
      margin-top: 0.5rem;
    }

    .help-subsection li::before {
      content: "-";
    }

    @media (max-width: 768px) {
      .help-modal {
        padding: 1rem;
      }

      .help-modal-content {
        padding: 1.5rem;
        width: 95%;
      }
    }

    /* Gemeenschappelijke button styling */
    .btn-primary, .btn-copy, .btn-chatgpt, .btn-generate {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 8px;
      text-align: left;
      position: relative;
      color: white;
      height: 45px; /* Vaste hoogte voor alle knoppen */
    }

    /* Container voor alle knoppen */
    .button-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }

    /* Zorg dat alle knoppen in beide groepen dezelfde stijl hebben */
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }

    .btn-generate {
      background: var(--primary);
    }

    .btn-primary {
      background: var(--primary);
    }

    .btn-copy {
      background: var(--warning);
      color: black;
    }

    .btn-chatgpt {
      background: var(--success);
    }

    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .full-width {
      width: 100%;
    }

    /* Consistente hover effecten */
    .btn-primary:not(.btn-disabled):hover,
    .btn-copy:not(.btn-disabled):hover,
    .btn-chatgpt:not(.btn-disabled):hover,
    .btn-generate:not(.btn-disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .btn-icon {
      margin-right: 8px;
      font-size: 1.2em;
    }

    .shortcut-hint {
      position: absolute;
      right: 15px;
      font-size: 0.9em;
      opacity: 0.8;
    }

    /* Basis knop stijlen */
    .btn-base {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 12px 15px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 8px;
      height: 48px; /* Vaste hoogte voor alle knoppen */
      position: relative;
      color: white;
    }

    /* Specifieke knop varianten */
    .btn-generate {
      composes: btn-base;
      background: var(--primary);
    }

    .btn-primary {
      composes: btn-base;
      background: var(--primary);
    }

    .btn-copy {
      composes: btn-base;
      background: var(--warning);
      color: black;
    }

    .btn-chatgpt {
      composes: btn-base;
      background: var(--success);
    }

    /* Knop states */
    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Hover effecten */
    .btn-generate:not(.btn-disabled):hover,
    .btn-primary:not(.btn-disabled):hover,
    .btn-copy:not(.btn-disabled):hover,
    .btn-chatgpt:not(.btn-disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* Knop content layout */
    .btn-icon {
      margin-right: 8px;
      font-size: 1.2em;
      flex-shrink: 0;
    }

    .btn-text {
      flex-grow: 1;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .shortcut-hint {
      margin-left: 8px;
      font-size: 0.9em;
      opacity: 0.8;
      flex-shrink: 0;
    }

    /* Knop containers */
    .button-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
      margin-bottom: 16px;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }

    /* Button row styling */
    .button-row {
      display: flex;
      gap: 12px;
      width: 100%;
      margin-bottom: 12px;
    }

    .button-row > button {
      flex: 1;
      min-width: 0; /* Voorkomt overflow op kleine schermen */
    }

    /* Knoppen hebben gelijke hoogte binnen een rij */
    .button-row button {
      height: 48px;
      display: flex;
      align-items: center;
      padding: 10px 15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Responsive layout */
    @media (max-width: 768px) {
      .button-row {
        flex-direction: column;
        gap: 8px;
      }

      .button-row button {
        width: 100%;
      }
    }

    /* Behoud bestaande button styling */
    .btn-primary, .btn-copy, .btn-chatgpt {
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-copy {
      background: var(--warning);
      color: black;
    }

    .btn-chatgpt {
      background: var(--success);
      color: white;
    }

    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Hover effecten */
    .btn-primary:not(.btn-disabled):hover,
    .btn-copy:not(.btn-disabled):hover,
    .btn-chatgpt:not(.btn-disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* Horizontale knop groepen */
    .ai-knoppen {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .knop-rij {
      display: flex;
      gap: 8px;
      width: 100%;
    }

    .knop-rij > button {
      flex: 1;
    }

    @media (max-width: 768px) {
      .knop-rij {
        flex-direction: column;
      }
    }

    @media (max-width: 768px) {
      .observatie-knoppen {
        flex-direction: column;
        gap: 0.5rem;
      }
      .opname-knoppen {
        width: 100%;
        margin-bottom: 0.5rem;
      }
      .ai-knoppen {
        display: flex;
        flex-direction: column;
        gap: 8px;
        width: 100%;
        margin-top: 0;
      }
      .ai-knoppen .knop-rij {
        flex-direction: column;
        gap: 8px;
        width: 100%;
      }
      .ai-knoppen button {
        width: 100%;
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
        margin: 0;
        height: 48px;
        font-size: 1rem;
      }
    }

    /* ... bestaande CSS ... */
    .versie {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.5rem;
    }

    /* Versie-informatie styling */
    .version-info {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      font-size: 0.8rem;
      opacity: 0.7;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .version-info a {
      color: var(--primary);
      text-decoration: none;
    }

    .version-info a:hover {
      text-decoration: underline;
    }

    /* Update notificatie styling */
    .update-notification {
      position: fixed;
      bottom: 3rem;
      right: 1rem;
      background: var(--success);
      color: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .update-notification.show {
      display: block;
    }

    .update-notification a {
      color: white;
      text-decoration: underline;
    }

    /* Versie-informatie styling in header */
    .version-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.9rem;
      background: var(--primary);
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 0.5rem;
    }

    .version-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .version-badge .material-icons {
      font-size: 1rem;
    }

    .subtitle {
      color: var(--text-light);
      opacity: 0.8;
      margin-top: 0.25rem;
    }

    body.dark-mode .subtitle {
      color: var(--text-dark);
    }

    /* Changelog error styling */
    .changelog-error {
      padding: 1rem;
      background: var(--danger);
      color: white;
      border-radius: 8px;
      margin: 1rem 0;
    }

    .changelog-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      color: var(--text-light);
    }

    body.dark-mode .changelog-loading {
      color: var(--text-dark);
    }

    /* Verwijder oude version-info styling */
    .version-info {
      display: none; /* Verwijder oude versie-info */
    }

    /* Header en versie badge styling */
    .app-header {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .app-header h1 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0;
      padding-right: 3rem; /* Ruimte voor de header buttons */
    }

    .version-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.9rem;
      background: var(--primary);
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 0.5rem;
      text-decoration: none;
    }

    .version-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .version-badge .material-icons {
      font-size: 1rem;
    }

    /* Notifications styling */
    .notifications-container {
      margin-bottom: 1rem;
    }

    .update-banner {
      background: var(--success);
      color: white;
      padding: 0.75rem;
      border-radius: 8px;
      display: none;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }

    .update-banner.show {
      display: flex;
    }

    .error-message {
      background: var(--danger);
      color: white;
      padding: 0.75rem;
      border-radius: 8px;
      display: none;
      align-items: center;
      gap: 0.5rem;
    }

    .error-message.show {
      display: flex;
    }

    /* Verwijder oude versie-badge */
    .version-info,
    .version-badge[style*="position: absolute"] {
      display: none !important;
    }

    /* Verbeterde Changelog styling */
    .changelog-content {
      margin-top: 1rem;
    }

    .changelog-versie {
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .changelog-header {
      background: var(--primary);
      color: white;
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nieuw-badge {
      background: var(--success);
      color: white;
      font-size: 0.8rem;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
    }

    .changelog-body {
      padding: 1rem;
    }

    .changelog-body h3 {
      color: var(--primary);
      margin: 1rem 0 0.5rem 0;
    }

    .changelog-body ul {
      margin-left: 1.5rem;
    }

    .changelog-body li {
      margin-bottom: 0.25rem;
    }

    body.dark-mode .changelog-versie {
      border-color: #444;
    }

    /* Offline indicator */
    .offline-indicator {
      background: var(--warning);
      color: white;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      display: none;
      align-items: center;
      gap: 0.5rem;
    }

    .offline-indicator.show {
      display: flex;
    }
  </style>
  <div id="notification-container" class="notification-container"></div>
  <!-- Voeg deze HTML toe net voor de sluitende body tag -->
  </style>
  <div id="notification-container" class="notification-container"></div>
  <!-- Voeg deze HTML toe net voor de sluitende body tag -->
  <div id="promptOverlay" class="overlay">
    <div class="overlay-content">
      <button class="overlay-close" onclick="sluitOverlay()">×</button>
      <h3>Prompt kopiëren naar ChatGPT</h3>
      <div class="overlay-text">
        <p>Volg deze stappen:</p>
        <ol>
          <li>Klik op de knop hieronder om de prompt te kopiëren</li>
          <li>Klik op 'Open ChatGPT' om ChatGPT te openen</li>
          <li>Plak de prompt in ChatGPT met Ctrl+V (Windows) of ⌘+V (Mac)</li>
        </ol>
      </div>
      <div class="overlay-buttons">
        <button onclick="kopieerPrompt()" class="btn btn-primary">
          <span class="material-icons">content_copy</span>
          Kopieer Prompt
        </button>
        <button onclick="openChatGPTVanuitOverlay()" class="btn btn-success">
          <span class="material-icons">open_in_new</span>
          Open ChatGPT
        </button>
      </div>
      <div id="copyStatus" class="copy-status"></div>
    </div>
  </div>
  <!-- Voeg deze HTML toe net voor de sluitende body tag -->
  <div id="helpModal" class="help-modal">
    <div class="help-modal-content">
      <button class="help-modal-close" onclick="closeHelp()">×</button>
      <h1>AI Rapportagecontrole Help</h1>
      
      <div class="help-section">
        <h2>🎯 Doel</h2>
        <p>Deze tool helpt je bij het maken en verbeteren van professionele rapportages met behulp van AI-ondersteuning.</p>
      </div>

      <div class="help-section">
        <h2>🚀 Hoofdfuncties</h2>
        
        <h3>1. AI-ondersteuning</h3>
        <ul>
          <li>Spelling/grammatica controle</li>
          <li>Herformuleringen voor inspiratie</li>
          <li>Volledige controle (taal + stijl)</li>
          <li>Privacy-bewuste verwerking</li>
        </ul>

        <h3>2. Rapportagemethodes</h3>
        <ul>
          <li>SOEP-methodiek:
            <ul class="help-subsection">
              <li>S: Subjectief (ervaring/beleving cliënt)</li>
              <li>O: Objectief (waarnemingen)</li>
              <li>E: Evaluatie (professionele inschatting)</li>
              <li>P: Plan (vervolgstappen)</li>
            </ul>
          </li>
          <li>Objectieve rapportage (vrije observatie)</li>
          <li>Keuze tussen methodieken per rapportage</li>
        </ul>

        <h3>3. Deelnemersbeheer</h3>
        <ul>
          <li>Voeg deelnemers toe/verwijder</li>
          <li>Wijzig deelnemernamen</li>
          <li>Exporteer/importeer deelnemerslijsten</li>
          <li>Backup/herstel alle rapportages</li>
          <li>Auto-save functionaliteit</li>
          <li>Flexibel gebruik: met/zonder deelnemers</li>
        </ul>

        <h3>4. Invoermethodes</h3>
        <ul>
          <li>Type direct in het tekstveld</li>
          <li>Spraak-naar-tekst (beste in Chrome):
            <ul class="help-subsection">
              <li>Nederlandse spraakherkenning</li>
              <li>Automatische punctuatie</li>
              <li>Doorlopende opname mogelijk</li>
            </ul>
          </li>
          <li>Plak gekopieerde tekst</li>
          <li>Combineer verschillende invoermethodes</li>
        </ul>

        <h3>5. AI-Prompt Workflow</h3>
        <ul>
          <li>1. Genereer prompt:
            <ul class="help-subsection">
              <li>Voor huidige observatie (Alt+G)</li>
              <li>Voor alle deelnemers samen (Alt+A)</li>
            </ul>
          </li>
          <li>2. Kopieer prompt naar klembord (Alt+C)</li>
          <li>3. Open en plak in ChatGPT (Alt+O)</li>
          <li>Duidelijke kleurcodering per stap</li>
          <li>Automatische knop-activering</li>
        </ul>

        <h3>6. Extra features</h3>
        <ul>
          <li>Direct rapporteren zonder deelnemer als er geen/één deelnemer is</li>
          <li>Deelnemer selectie alleen nodig bij meerdere deelnemers</li>
          <li>Opnames worden toegevoegd aan bestaande tekst</li>
          <li>Offline modus beschikbaar</li>
          <li>Dark/Light thema aanpasbaar</li>
          <li>Responsive op alle apparaten</li>
          <li>Privacy-vriendelijk (lokale opslag)</li>
          <li>Automatische backups</li>
        </ul>
      </div>

      <div class="help-section">
        <h2>⌨️ Sneltoetsen</h2>
        <ul>
          <li>Alt + G: Genereer prompt voor huidige observatie</li>
          <li>Alt + A: Genereer prompt voor alle deelnemers</li>
          <li>Alt + C: Kopieer prompt naar klembord</li>
          <li>Alt + O: Open ChatGPT in nieuw tabblad</li>
          <li>Alt + R: Reset velden</li>
          <li>Alt + M: Dark/Light mode</li>
          <li>Alt + S: Start opname</li>
          <li>Alt + P: Stop opname</li>
        </ul>
      </div>

      <div class="help-section">
        <h2>🔒 Privacy & Beveiliging</h2>
        <ul>
          <li>Gebruik nooit persoonlijke gegevens in rapportages</li>
          <li>Alle data wordt lokaal opgeslagen</li>
          <li>Geen internet nodig (behalve voor AI)</li>
          <li>Geen data-uitwisseling met servers</li>
          <li>Exporteer regelmatig voor backup</li>
        </ul>
      </div>

      <div class="help-section">
        <h2>💾 Data & Synchronisatie</h2>
        <ul>
          <li>Alles wordt lokaal opgeslagen</li>
          <li>Desktop en mobiel zijn gescheiden</li>
          <li>Gebruik export/import voor synchronisatie</li>
          <li>Automatische backups bij wijzigingen</li>
          <li>CSV-export voor Excel compatibiliteit</li>
          <li>JSON-backups voor volledige data</li>
        </ul>
      </div>

      <div class="help-section">
        <h2>❓ Tips</h2>
        <ul>
          <li>Begin met het kiezen van een rapportagemethode</li>
          <li>Gebruik spraakopname voor snelle invoer</li>
          <li>Maak regelmatig backups van je data</li>
          <li>Exporteer belangrijke rapportages</li>
          <li>Check de gegenereerde AI-prompt voor verzending</li>
          <li>Gebruik de sneltoetsen voor efficiënt werken</li>
        </ul>
      </div>
    </div>
  </div>
  <!-- Voeg deze HTML toe net voor de sluitende body tag -->
  <div id="changelog-modal" class="help-modal">
    <div class="help-modal-content">
      <button class="help-modal-close" onclick="sluitChangelog()">×</button>
      <h1>Wijzigingsgeschiedenis</h1>
      <div id="changelog-content" class="changelog-content">
        <div class="changelog-loading">
          <span class="material-icons" style="margin-right: 0.5rem;">hourglass_empty</span>
          Changelog laden...
        </div>
      </div>
    </div>
  </div>
  <!-- Service Worker registratie -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./assets/sw.js')
          .then(function(registration) {
            console.log('ServiceWorker registratie succesvol: ', registration.scope);
          })
          .catch(function(error) {
            console.log('ServiceWorker registratie mislukt: ', error);
          });
      });
    }
  </script>
</head>
<body>
  <!-- Verwijder oude versie-badge -->
  <div class="version-badge" style="display: none !important; position: absolute;"></div>

  <div id="notification-container" class="notification-container"></div>
  <div class="container">
    <!-- Header buttons -->
    <div class="header-buttons">
      <button class="btn" onclick="toggleDarkMode()" title="Wissel tussen donker en licht thema">
        <span class="dark-icon material-icons">dark_mode</span>
        <span class="light-icon material-icons">light_mode</span>
        <span class="mode-text">Donker</span>
      </button>
      <button class="btn" onclick="showHelp()" title="Bekijk de gebruikershandleiding">
        <span class="material-icons">help_outline</span>
        Help
      </button>
    </div>
    
    <!-- Notifications container -->
    <div class="notifications-container">
      <div class="update-banner" id="update-banner">
        <span>🎉 Er is een nieuwe versie beschikbaar!</span>
        <button onclick="laadNieuweVersie()">Nu updaten</button>
        <button onclick="toonChangelog()">Bekijk wijzigingen</button>
      </div>

      <div class="error-message" id="error-message">
        <span class="material-icons">error_outline</span>
        <span id="error-text"></span>
      </div>
    </div>

    <!-- Header -->
    <div class="app-header">
      <h1>
        RAP TOOL - AI Rapportagecontrole
        <span class="version-badge" onclick="toonChangelog()" title="Bekijk wijzigingsgeschiedenis">
          <span class="material-icons">info</span>
          v<span id="current-version">...</span>
        </span>
      </h1>
      <p class="subtitle">Verbeter je rapportages met AI-ondersteuning</p>
    </div>

    <!-- Welkomstmelding die automatisch verdwijnt -->
    <div class="info">
      <strong>Welkom bij de AI Rapportagecontrole Tool!</strong><br>
      Begin met het toevoegen of selecteren van een deelnemer. Hierna kun je rapportages maken via typen of spraakherkenning.
      <br>Gebruik de help-knop rechtsboven voor meer informatie.
    </div>

    <!-- AI Instellingen -->
    <label for="keuze">🧠 Wat wil je dat AI doet met je tekst?</label>
    <select id="keuze" onchange="toonUitleg()">
      <option value="taal">Alleen spelling/grammatica controleren</option>
      <option value="suggesties">Geef herformuleringen (inspiratie)</option>
      <option value="combi" selected>Volledige controle en herschrijving (taal + stijl)</option>
    </select>
    <div class="uitleg" id="uitleg">Toont uitleg over de geselecteerde AI-functie.</div>

    <label for="methode">🗂️ Welke rapportagemethode gebruik je?</label>
    <div style="display: flex; align-items: center;">
      <select id="methode">
        <option value="soep">SOEP</option>
        <option value="objectief" selected>Objectief (vrij)</option>
      </select>
      <div class="help-tooltip" tabindex="0" aria-label="Wat is SOEP?">?
        <div class="tooltip-content">
          <strong>SOEP-methodiek uitleg:</strong><br>
          <strong>S</strong> = Subjectief: de ervaring/beleving van cliënt<br>
          <strong>O</strong> = Objectief: wat je objectief waarneemt<br>
          <strong>E</strong> = Evaluatie: jouw professionele inschatting<br>
          <strong>P</strong> = Plan: wat je hiermee gaat doen/opvolgt
        </div>
      </div>
    </div>

    <!-- Deelnemers sectie -->
    <div class="deelnemer-section">
      <div class="deelnemer-header">
        <h3>👥 Deelnemers</h3>
      </div>
      
      <div class="deelnemer-controls">
        <div class="deelnemer-select">
          <select id="deelnemerSelect" onchange="selecteerDeelnemer()">
            <option value="">Selecteer een deelnemer...</option>
          </select>
        </div>
        <div class="action-groups-container">
          <div class="action-group">
            <button onclick="voegDeelnemerToe()" class="btn btn-primary" title="Voeg een nieuwe deelnemer toe">
              <span class="material-icons">person_add</span>
              Nieuw
            </button>
            <button onclick="wijzigDeelnemerNaam()" class="btn btn-warning" title="Wijzig de naam van de geselecteerde deelnemer">
              <span class="material-icons">edit</span>
              Wijzig
            </button>
            <button onclick="verwijderDeelnemer()" class="btn btn-danger" title="Verwijder de geselecteerde deelnemer">
              <span class="material-icons">person_remove</span>
              Verwijder
            </button>
          </div>
          <div class="action-group">
            <button onclick="exporteerDeelnemers()" class="btn btn-success" title="Exporteer alle deelnemers en hun rapportages">
              <span class="material-icons">file_download</span>
              Export
            </button>
            <button onclick="document.getElementById('importFile').click()" class="btn btn-warning" title="Importeer deelnemers en rapportages">
              <span class="material-icons">file_upload</span>
              Import
            </button>
            <input type="file" id="importFile" style="display: none" onchange="importeerDeelnemers(this)">
          </div>
        </div>
      </div>
    </div>

    <label for="input">📝 Plak hier je observatie:</label>
    <div class="privacy-tip">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
      <span>Privacy tip: gebruik geen persoonlijke gegevens zoals volledige namen of BSN-nummers</span>
    </div>

    <!-- Melding wanneer geen deelnemer is geselecteerd -->
    <div id="deelnemerVereistMelding" class="deelnemer-required-message">
      <span class="material-icons">info</span>
      <span>Selecteer eerst een deelnemer voordat je een observatie kunt invoeren.</span>
    </div>

    <div class="input-wrapper">
      <textarea id="input" placeholder="Bijv: Cliënt kwam boos binnen..." disabled></textarea>
      <div class="clear-btn" onclick="clearInput()" title="Wis tekst">✕</div>
    </div>
    
    <div class="recording-indicator" id="opnameIndicator">
      <span class="recording-dot"></span>
      <span class="recording-text">Opname actief</span>
      <span class="recording-deelnemer"></span>
      <span class="timer" id="opnameTijd">00:00</span>
    </div>

    <div class="observatie-knoppen">
      <div class="opname-knoppen">
        <button id="startOpname" onclick="startOpname()" class="btn-success" title="Start spraakopname" disabled>
          <span class="btn-icon">🎤</span>Start opname
        </button>
        <button id="stopOpname" onclick="stopOpname()" class="btn-danger" disabled title="Stop opname">
          <span class="btn-icon">⏹️</span>Stop opname
        </button>
      </div>
      <div class="ai-knoppen">
        <!-- Eerste rij met genereer knoppen -->
        <div class="knop-rij">
          <button id="genBtn" onclick="genereerPrompt()" class="btn-primary full-width" 
            title="1. Genereer AI-prompt voor huidige observatie">
            <span class="btn-icon">✨</span>1. Genereer AI-prompt<span class="shortcut-hint">Alt+G</span>
          </button>
          <button id="genAlleBtn" onclick="genereerPromptVoorAlleDeelnemers()" class="btn-primary full-width" 
            title="1. Genereer één AI-prompt voor alle deelnemers samen">
            <span class="btn-icon">🔄</span>1. AI-prompt voor alle deelnemers<span class="shortcut-hint">Alt+A</span>
          </button>
        </div>

        <!-- Tweede rij met kopieer en open knoppen -->
        <div class="knop-rij">
          <button id="copyPromptBtn" onclick="copyPrompt()" class="btn-copy full-width btn-disabled" disabled 
            title="2. Kopieer de gegenereerde prompt naar het klembord">
            <span class="btn-icon">📋</span>2. Kopieer prompt<span class="shortcut-hint">Alt+C</span>
          </button>
          <button id="openChatGPTBtn" onclick="openInChatGPT()" class="btn-chatgpt full-width btn-disabled" disabled 
            title="3. Open de gegenereerde prompt in ChatGPT">
            <span class="btn-icon">🚀</span>3. Open in ChatGPT<span class="shortcut-hint">Alt+O</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Rapportages sectie -->
    <div class="backup-section">
      <div class="backup-header">
        <h3>📋 Rapportages</h3>
      </div>
      <div class="backup-controls">
        <button onclick="maakBackup()" class="btn btn-primary" title="Maak een backup van alle rapportages">
          <span class="material-icons">save</span>
          Backup
        </button>
        <button onclick="document.getElementById('laadBackupFile').click()" class="btn btn-warning" title="Herstel rapportages vanuit backup">
          <span class="material-icons">restore</span>
          Herstel
        </button>
        <button onclick="resetAlles()" class="btn btn-danger" title="Verwijder alle rapportages en deelnemers">
          <span class="material-icons">delete_forever</span>
          Reset alles
        </button>
        <input type="file" id="laadBackupFile" style="display: none" onchange="laadBackup(this)">
      </div>
    </div>

    <h2>📄 Gegenereerde prompt:</h2>
    <pre id="output"></pre>
    
    <footer class="footer">
      <div class="footer-content">
        <div class="copyright">
          &copy; <span id="copyrightYear"></span> Ahatsuki Studios - Alle rechten voorbehouden
        </div>
        <div class="donate-section">
          <button class="btn btn-warning donate-button" onclick="toonDonatieOpties()">
            <span class="btn-icon">💛</span>
            Steun ons
          </button>
          <div id="donatie-opties" class="donatie-menu">
            <button onclick="window.open('https://buymeacoffee.com/AhatsukiStudio', '_blank')" class="btn btn-primary donate-option">
              <span class="btn-icon">☕</span>
              Buy me a Coffee
            </button>
            <button onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=XJKBCDQ3NSK8Y', '_blank')" class="btn btn-primary donate-option">
              <span class="btn-icon">💙</span>
              PayPal Donatie
            </button>
          </div>
        </div>
      </div>
    </footer>

    <div class="offline-indicator">
      <span class="material-icons">cloud_off</span>
      <span>Je bent offline. Wijzigingen worden lokaal opgeslagen.</span>
    </div>
  </div>

  <!-- Versie-informatie -->
  <div class="version-info">
    <span>Versie <span id="current-version">...</span></span>
    <a href="CHANGELOG.md" target="_blank">Changelog</a>
  </div>

  <!-- Update notificatie -->
  <div class="update-notification" id="update-notification">
    Er is een nieuwe versie beschikbaar! 
    <a href="CHANGELOG.md" target="_blank">Bekijk de wijzigingen</a>
  </div>

  <script>
    // Globale state object
    window.globals = {
      huidigePrompt: "",
      permanenteTranscript: "",
      laatsteInterimTranscript: "",
      opnameStartTijd: null,
      opnameTijdTimer: null,
      isOffline: false,
      autoSaveTimeout: null,
      deelnemers: [],
      rapportages: {},
      huidigeDeelnemer: '',
      recognition: null,
      isOpnameActief: false
    };

    // Event listeners setup
    function setupEventListeners() {
      // Online/Offline status
      window.addEventListener('online', function() {
        document.body.classList.remove('offline');
        globals.isOffline = false;
        showNotification('Je bent weer online', 'success');
      });

      window.addEventListener('offline', function() {
        document.body.classList.add('offline');
        globals.isOffline = true;
        showNotification('Je bent offline. Wijzigingen worden lokaal opgeslagen.', 'warning');
      });

      // Help modal sluiten bij klik buiten modal
      document.addEventListener('click', function(event) {
        const helpModal = document.getElementById('helpModal');
        if (event.target === helpModal) {
          closeHelp();
        }
      });

      // Toetsenbordsnelkoppelingen
      document.addEventListener('keydown', function(event) {
        // Alleen activeren als Alt-toets is ingedrukt
        if (event.altKey) {
          switch(event.key.toLowerCase()) {
            case 'g': // Alt+G: Genereer prompt
              event.preventDefault();
              const genBtn = document.getElementById('genBtn');
              if (!genBtn.disabled) {
                genereerPrompt();
              }
              break;
            case 'a': // Alt+A: Genereer alle prompts
              event.preventDefault();
              const genAlleBtn = document.querySelector('button[onclick="genereerAllePrompts()"]');
              if (!genAlleBtn.disabled) {
                genereerAllePrompts();
              }
              break;
            case 'o': // Alt+O: Open in ChatGPT
              event.preventDefault();
              const openBtn = document.getElementById('openChatGPTBtn');
              if (!openBtn.disabled) {
                openInChatGPT();
              }
              break;
            case 's': // Alt+S: Start opname
              event.preventDefault();
              const startBtn = document.getElementById('startOpname');
              if (!startBtn.disabled) {
                startOpname();
              }
              break;
            case 'p': // Alt+P: Stop opname
              event.preventDefault();
              const stopBtn = document.getElementById('stopOpname');
              if (!stopBtn.disabled) {
                stopOpname();
              }
              break;
            case 'm': // Alt+M: Toggle dark mode
              event.preventDefault();
              toggleDarkMode();
              break;
            case 'r': // Alt+R: Reset velden
              event.preventDefault();
              if (globals.huidigeDeelnemer) {
                clearInput();
              }
              break;
            case 'c': // Alt+C: Kopieer prompt
              event.preventDefault();
              const copyBtn = document.getElementById('copyPromptBtn');
              if (!copyBtn.disabled) {
                kopieerPromptNaarKlembord();
              }
              break;
          }
        }
      });

      // Input veld auto-save
      const input = document.getElementById('input');
      if (input) {
        input.addEventListener('input', () => {
          // Update de genereer knop status
          const genBtn = document.getElementById('genBtn');
          const heeftInput = input.value.trim() !== '';
          genBtn.disabled = !heeftInput;
          genBtn.classList.toggle('btn-disabled', !heeftInput);
          
          // Auto-save alleen als er een deelnemer is geselecteerd
          if (globals.huidigeDeelnemer) {
            clearTimeout(globals.autoSaveTimeout);
            globals.autoSaveTimeout = setTimeout(() => {
              slaRapportageOp();
              showNotification('Rapportage automatisch opgeslagen', 'success', 1000);
            }, 1000);
          }
        });
      }

      // Donatie menu sluiten bij klik buiten
      document.addEventListener('click', function(event) {
        const donatieMenu = document.getElementById('donatie-opties');
        const donateButton = document.querySelector('.donate-button');
        
        if (donatieMenu && donatieMenu.style.display === 'flex') {
          const clickedOnButton = donateButton && donateButton.contains(event.target);
          const clickedOnMenu = donatieMenu.contains(event.target);
          
          if (!clickedOnButton && !clickedOnMenu) {
            donatieMenu.style.display = 'none';
          }
        }
      });
    }

    // Voeg deze regel toe aan de DOMContentLoaded event listener
    document.addEventListener('DOMContentLoaded', function() {
      debugLog('DOMContentLoaded event gestart', {});
      
      try {
        // Controleer of er deelnemers zijn, zo niet, voeg standaard deelnemer toe
        if (!Array.isArray(globals.deelnemers) || globals.deelnemers.length === 0) {
          globals.deelnemers = ['Deelnemer'];
          globals.rapportages['Deelnemer'] = [];
          saveToLocalStorage('deelnemers', globals.deelnemers);
          saveToLocalStorage('rapportages', globals.rapportages);
        }
        
        // Setup event listeners
        setupEventListeners();
        
        // Laad dark mode voorkeur
        if (localStorage.getItem('darkMode') === 'true') {
          document.body.classList.add('dark-mode');
          const modeText = document.querySelector('.mode-text');
          if (modeText) {
            modeText.textContent = 'Licht';
          }
        }
        
        // Update UI
        updateDeelnemersList();
        
      } catch (error) {
        console.error('Fout bij initialisatie:', error);
        showNotification('Er was een probleem bij het laden van de applicatie.', 'error');
      }
    });

    // Hulpfunctie om te controleren of deelnemers een array is
    function ensureDeelnemersArray() {
      if (!Array.isArray(globals.deelnemers)) {
        console.warn('Deelnemers was geen array, wordt gereset');
        globals.deelnemers = [];
      }
      return globals.deelnemers;
    }

    // Debug functie
    function debugLog(message, data) {
      console.log(`[Debug] ${message}:`, data);
    }

    // Initialiseer deelnemers bij laden pagina
    document.addEventListener('DOMContentLoaded', function() {
      debugLog('DOMContentLoaded event gestart', {});
      
      try {
        // Laad en corrigeer opgeslagen deelnemers
        const opgeslagenDeelnemers = loadFromLocalStorage('deelnemers');
        debugLog('Opgeslagen deelnemers uit localStorage', opgeslagenDeelnemers);
        
        if (opgeslagenDeelnemers) {
          globals.deelnemers = Array.isArray(opgeslagenDeelnemers) ? opgeslagenDeelnemers : [];
        } else {
          globals.deelnemers = [];
        }
        
        // Laad opgeslagen rapportages
        const opgeslagenRapportages = loadFromLocalStorage('rapportages');
        if (opgeslagenRapportages) {
          globals.rapportages = opgeslagenRapportages;
        } else {
          globals.rapportages = {};
        }
        
        // Update UI en setup
        updateDeelnemersList();
        setupEventListeners();
        setupSpeechRecognition();
        
        // Update UI elements
        updateUI();
        
      } catch (error) {
        console.error('Fout bij initialisatie:', error);
        showNotification('Er was een probleem bij het laden van de applicatie.', 'error');
        
        // Reset naar lege arrays bij fouten
        globals.deelnemers = [];
        globals.rapportages = {};
        
        // Update UI
        updateUI();
      }
    });

    function updateDeelnemersList() {
      ensureDeelnemersArray();
      
      debugLog('updateDeelnemersList aangeroepen', {
        huidigeDeelnemers: globals.deelnemers,
        aantalDeelnemers: globals.deelnemers.length
      });
      
      const select = document.getElementById('deelnemerSelect');
      if (!select) {
        console.error('deelnemerSelect element niet gevonden!');
        return;
      }
      
      // Reset select
      select.innerHTML = '<option value="">Selecteer een deelnemer...</option>';
      
      // Voeg deelnemers toe
      globals.deelnemers.forEach(deelnemer => {
        const option = document.createElement('option');
        option.value = deelnemer;
        option.textContent = deelnemer;
        select.appendChild(option);
      });
      
      // Selecteer huidige deelnemer als die er is
      if (globals.huidigeDeelnemer && globals.deelnemers.includes(globals.huidigeDeelnemer)) {
        select.value = globals.huidigeDeelnemer;
      }
      
      debugLog('Deelnemerslijst bijgewerkt', {
        aantalOptiesInSelect: select.options.length,
        geselecteerdeWaarde: select.value
      });
    }

    // Exporteer naar Excel/CSV formaat
    function exporteerDeelnemers() {
      try {
        // Headers voor de CSV
        let csvContent = "Deelnemer;Observatie;Datum;Laatst bijgewerkt;Methode\n";
        
        // Voor elke deelnemer
        globals.deelnemers.forEach(deelnemer => {
          const rapportages = globals.rapportages[deelnemer] || [];
          if (Array.isArray(rapportages) && rapportages.length > 0) {
            rapportages.forEach(rapportage => {
              // Escape eventuele puntkomma's in de tekst
              const escapedTekst = rapportage.tekst ? rapportage.tekst.replace(/;/g, ',') : '';
              const datum = rapportage.datum ? new Date(rapportage.datum).toLocaleString('nl-NL') : '';
              const laatstBijgewerkt = rapportage.laatst_bijgewerkt ? 
                new Date(rapportage.laatst_bijgewerkt).toLocaleString('nl-NL') : '';
              
              // Voeg rij toe aan CSV
              csvContent += `${deelnemer};${escapedTekst};${datum};${laatstBijgewerkt};${rapportage.methode || ''}\n`;
            });
          } else {
            // Voeg altijd een lege regel toe voor deelnemers zonder observatie
            csvContent += `${deelnemer};;;;\n`;
          }
        });
        
        // Converteer naar Blob met BOM voor Excel
        const blob = new Blob(["\ufeff" + csvContent], { 
          type: 'text/csv;charset=utf-8;' 
        });
        
        // Download bestand
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `deelnemers_export_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showNotification('Deelnemerslijst succesvol geëxporteerd!', 'success');
      
      } catch (error) {
        console.error('Fout bij exporteren:', error);
        showNotification('Er ging iets mis bij het exporteren.', 'error');
      }
    }

    // Importeer vanuit Excel/CSV formaat
    function importeerDeelnemers(input) {
      debugLog('importeerDeelnemers aangeroepen', { input });
      
      const file = input.files[0];
      if (!file) {
        showNotification('Geen bestand geselecteerd', 'warning');
        return;
      }

      // Controleer bestandstype
      if (!file.name.toLowerCase().endsWith('.csv')) {
        showNotification('Alleen CSV bestanden worden ondersteund. Sla je Excel bestand op als CSV.', 'warning');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          let content = e.target.result;
          debugLog('Bestandsinhoud gelezen', { contentLength: content.length });
          
          // Verwijder BOM als aanwezig
          if (content.charCodeAt(0) === 0xFEFF) {
            content = content.slice(1);
          }
          
          // Split in regels en verwijder lege regels
          const regels = content.split(/\r?\n/).filter(regel => regel.trim());
          debugLog('Regels gevonden', { aantalRegels: regels.length, eersteRegel: regels[0] });
          
          if (regels.length === 0) {
            showNotification('Het bestand is leeg', 'warning');
            return;
          }

          // Detecteer scheidingsteken (comma of puntkomma)
          const eersteRegel = regels[0];
          const scheidingsteken = eersteRegel.includes(';') ? ';' : ',';
          debugLog('Scheidingsteken gedetecteerd', { scheidingsteken });
          
          // Controleer headers
          const headers = eersteRegel.split(scheidingsteken).map(h => h.trim().toLowerCase());
          debugLog('Headers gevonden', { headers });
          
          const heeftDeelnemer = headers.some(h => h === 'deelnemer' || h.includes('naam'));
          const heeftObservatie = headers.some(h => h === 'observatie' || h === 'rapportage' || h === 'tekst');
          
          if (!heeftDeelnemer) {
            showNotification('Geen kolom "Deelnemer" of "Naam" gevonden in het bestand', 'error');
            return;
          }

          // Nieuwe data structuren
          const nieuweDeelnemers = new Set();
          const nieuweRapportages = {};
          
          // Verwerk elke regel (skip header)
          for (let i = 1; i < regels.length; i++) {
            const regel = regels[i].trim();
            if (!regel) continue;
            
            const velden = regel.split(scheidingsteken).map(v => v.trim());
            debugLog(`Verwerken regel ${i}`, { velden });
            
            if (velden.length < 1) continue;
            
            // Zoek deelnemer en observatie indices
            const deelnemerIndex = headers.findIndex(h => h === 'deelnemer' || h.includes('naam'));
            const observatieIndex = headers.findIndex(h => h === 'observatie' || h === 'rapportage' || h === 'tekst');
            const datumIndex = headers.findIndex(h => h.includes('datum'));
            const methodeIndex = headers.findIndex(h => h === 'methode');
            
            const deelnemer = velden[deelnemerIndex];
            if (!deelnemer) continue;
            
            debugLog(`Deelnemer gevonden`, { deelnemer, veldIndex: deelnemerIndex });
            nieuweDeelnemers.add(deelnemer);
            
            if (!nieuweRapportages[deelnemer]) {
              nieuweRapportages[deelnemer] = [];
            }
            
            // Als er een observatie kolom is en er staat iets in
            if (observatieIndex !== -1 && velden[observatieIndex]) {
              nieuweRapportages[deelnemer].push({
                tekst: velden[observatieIndex],
                datum: datumIndex !== -1 ? new Date(velden[datumIndex] || Date.now()).toISOString() : new Date().toISOString(),
                laatst_bijgewerkt: new Date().toISOString(),
                methode: methodeIndex !== -1 ? velden[methodeIndex] || 'objectief' : 'objectief'
              });
            }
          }
          
          debugLog('Verwerkte data', { 
            aantalDeelnemers: nieuweDeelnemers.size, 
            deelnemers: Array.from(nieuweDeelnemers),
            rapportages: Object.keys(nieuweRapportages)
          });

          if (nieuweDeelnemers.size === 0) {
            showNotification('Geen geldige deelnemers gevonden in het bestand. Controleer of de kolom "Deelnemer" of "Naam" correct is en of er deelnemers in staan.', 'warning');
            return;
          }
          
          // Verwijder de standaard "Deelnemer" als die bestaat
          if (globals.deelnemers.length === 1 && globals.deelnemers[0] === 'Deelnemer') {
            globals.deelnemers = [];
            delete globals.rapportages['Deelnemer'];
          }

          // Update globals
          globals.deelnemers = Array.from(nieuweDeelnemers);
          globals.rapportages = nieuweRapportages;
          
          // Sla op in localStorage
          saveToLocalStorage('deelnemers', globals.deelnemers);
          saveToLocalStorage('rapportages', globals.rapportages);
          
          // Reset huidige deelnemer
          globals.huidigeDeelnemer = '';
          document.getElementById('input').value = '';
          
          // Update UI
          updateDeelnemersList();
          showNotification(`${globals.deelnemers.length} deelnemer(s) succesvol geïmporteerd!`, "success");
          
        } catch (error) {
          console.error('Fout bij importeren:', error);
          showNotification('Er ging iets mis bij het importeren. Controleer of het bestand het juiste formaat heeft.', 'error');
        }
      };
      
      reader.onerror = function(error) {
        console.error('Fout bij lezen bestand:', error);
        showNotification('Fout bij het lezen van het bestand.', 'error');
      };
      
      reader.readAsText(file);
      input.value = '';
    }

    function voegDeelnemerToe() {
      const naam = prompt("Voer de naam van de deelnemer in:");
      
      // Input validatie
      if (!naam) {
        showNotification("Geen naam ingevoerd", "warning");
        return;
      }

      const deelnemer = naam.trim();
      
      // Extra validaties
      if (deelnemer.length < 2) {
        showNotification("De naam moet minimaal 2 karakters lang zijn", "warning");
        return;
      }

      if (deelnemer.length > 50) {
        showNotification("De naam mag niet langer zijn dan 50 karakters", "warning");
        return;
      }

      // Check op speciale karakters
      if (!/^[a-zA-Z0-9\s\-_.]+$/.test(deelnemer)) {
        showNotification("De naam mag alleen letters, cijfers, spaties, koppeltekens, punten en underscores bevatten", "warning");
        return;
      }
      
      debugLog('Nieuwe deelnemer toevoegen', { naam: deelnemer });
      
      ensureDeelnemersArray();
      
      // Controleer of deelnemer al bestaat
      if (globals.deelnemers.includes(deelnemer)) {
        showNotification("Deze deelnemer bestaat al", "warning");
        return;
      }
      
      try {
        // Controleer maximum aantal deelnemers
        if (globals.deelnemers.length >= 100) {
          showNotification("Maximum aantal deelnemers bereikt. Verwijder eerst enkele deelnemers.", "warning");
          return;
        }

        // Als dit de eerste handmatig toegevoegde deelnemer is, verwijder de standaard "Deelnemer"
        if (globals.deelnemers.length === 1 && globals.deelnemers[0] === 'Deelnemer') {
          globals.deelnemers = [];
          delete globals.rapportages['Deelnemer'];
        }

        // Voeg toe aan globals
        globals.deelnemers.push(deelnemer);
        
        // Initialiseer lege rapportage array
        globals.rapportages[deelnemer] = [];
        
        // Sla op in localStorage
        if (!saveToLocalStorage('deelnemers', globals.deelnemers)) {
          throw new Error('Kon deelnemers niet opslaan');
        }
        if (!saveToLocalStorage('rapportages', globals.rapportages)) {
          throw new Error('Kon rapportages niet opslaan');
        }
        
        debugLog('Deelnemer toegevoegd aan localStorage', {
          deelnemers: globals.deelnemers
        });
        
        // Update UI
        updateDeelnemersList();
        
        // Selecteer de nieuwe deelnemer
        globals.huidigeDeelnemer = deelnemer;
        const select = document.getElementById('deelnemerSelect');
        if (select) {
          select.value = deelnemer;
          selecteerDeelnemer();
        }
        
        showNotification(`Deelnemer "${deelnemer}" succesvol toegevoegd!`, "success");
        
      } catch (error) {
        console.error('Fout bij toevoegen deelnemer:', error);
        showNotification('Er ging iets mis bij het toevoegen van de deelnemer. Probeer het opnieuw.', 'error');
        
        // Probeer de wijzigingen terug te draaien
        try {
          const index = globals.deelnemers.indexOf(deelnemer);
          if (index > -1) {
            globals.deelnemers.splice(index, 1);
          }
          delete globals.rapportages[deelnemer];
        } catch (rollbackError) {
          console.error('Fout bij terugdraaien wijzigingen:', rollbackError);
        }
      }
    }

    // Bijgewerkte selecteerDeelnemer functie
    function selecteerDeelnemer() {
      const select = document.getElementById('deelnemerSelect');
      if (!select) {
        console.error('deelnemerSelect element niet gevonden!');
        return;
      }
      
      const nieuweDeelnemer = select.value;
      console.log('Selecteer deelnemer:', nieuweDeelnemer);
      
      // Sla eerst de huidige rapportage op
      if (globals.huidigeDeelnemer) {
        slaRapportageOp();
      }
      
      globals.huidigeDeelnemer = nieuweDeelnemer;
      
      // Toggle UI elementen op basis van of er een deelnemer is geselecteerd
      toggleInputFields(nieuweDeelnemer);
      
      // Laad rapportage van nieuwe deelnemer
      if (nieuweDeelnemer) {
        const rapportage = globals.rapportages[nieuweDeelnemer] || '';
        document.getElementById('input').value = rapportage;
        showNotification(`Rapportage van ${nieuweDeelnemer} geladen`, "info");
        
        // Verberg de melding
        document.getElementById('deelnemerVereistMelding').classList.remove('visible');
      } else {
        // Toon de melding als er geen deelnemer is geselecteerd
        document.getElementById('input').value = '';
        document.getElementById('deelnemerVereistMelding').classList.add('visible');
      }
    }

    // Helper functie om UI elementen te schakelen op basis van deelnemer selectie
    function toggleInputFields(deelnemer) {
      const inputElement = document.getElementById('input');
      const startOpnameBtn = document.getElementById('startOpname');
      const genBtn = document.getElementById('genBtn');
      const openChatGPTBtn = document.getElementById('openChatGPTBtn');
      const copyPromptBtn = document.getElementById('copyPromptBtn');
      const deelnemerVereistMelding = document.getElementById('deelnemerVereistMelding');
      const genAlleBtn = document.querySelector('button[onclick="genereerAllePrompts()"]');
      
      // ChatGPT en kopieer knoppen zijn alleen afhankelijk van of er een prompt is
      const heeftPrompt = globals.huidigePrompt && globals.huidigePrompt.trim() !== '';
      openChatGPTBtn.disabled = !heeftPrompt;
      copyPromptBtn.disabled = !heeftPrompt;
      openChatGPTBtn.classList.toggle('btn-disabled', !heeftPrompt);
      copyPromptBtn.classList.toggle('btn-disabled', !heeftPrompt);
      
      // Genereer knop is beschikbaar als er tekst in het input veld staat
      const heeftInput = inputElement.value.trim() !== '';
      genBtn.disabled = !heeftInput;
      genBtn.classList.toggle('btn-disabled', !heeftInput);
      
      // Bepaal of invoer en opname mogelijk zijn
      const geenDeelnemers = globals.deelnemers.length === 0;
      const enkeleDeelnemer = globals.deelnemers.length === 1;
      const heeftMeerdereDeelnemers = globals.deelnemers.length > 1;
      
      // Genereer alle rapportages knop beheer
      if (genAlleBtn) {
        const heeftDeelnemersMetRapportages = Object.values(globals.rapportages).some(rapportage => rapportage && rapportage.trim && rapportage.trim() !== '');
        genAlleBtn.disabled = geenDeelnemers || !heeftDeelnemersMetRapportages;
        genAlleBtn.classList.toggle('btn-disabled', geenDeelnemers || !heeftDeelnemersMetRapportages);
      }
      
      // Invoer is mogelijk als:
      // - Er geen deelnemers zijn
      // - Er maar één deelnemer is
      // - Er meerdere deelnemers zijn EN een deelnemer is geselecteerd
      const magInvoeren = geenDeelnemers || enkeleDeelnemer || (heeftMeerdereDeelnemers && deelnemer);
      
      // Input veld en opname knoppen beheer
      inputElement.disabled = !magInvoeren;
      inputElement.classList.toggle('input-disabled', !magInvoeren);
      startOpnameBtn.disabled = !magInvoeren;
      startOpnameBtn.classList.toggle('btn-disabled', !magInvoeren);
      
      // Toon alleen de melding als er meerdere deelnemers zijn en geen is geselecteerd
      if (heeftMeerdereDeelnemers && !deelnemer) {
        deelnemerVereistMelding.textContent = "Selecteer eerst een deelnemer voordat je een observatie kunt invoeren.";
        deelnemerVereistMelding.classList.add('visible');
      } else {
        deelnemerVereistMelding.classList.remove('visible');
      }
    }

    // Vervang de showHelp functie door deze nieuwe versie
    function showHelp() {
      document.getElementById('helpModal').style.display = 'flex';
    }

    function closeHelp() {
      document.getElementById('helpModal').style.display = 'none';
    }

    // Sluit help modal als er buiten wordt geklikt
    document.addEventListener('click', function(event) {
      const helpModal = document.getElementById('helpModal');
      const helpModalContent = helpModal.querySelector('.help-modal-content');
      if (event.target === helpModal) {
        closeHelp();
      }
    });

    function exportTool() {
      const htmlContent = document.documentElement.outerHTML;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'RAP TOOL NIEUW.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      showNotification('Tool succesvol geëxporteerd!', 'success');
    }

    // Verbeterde notificatie functie met wachtrij
    const notificationQueue = [];
    let isProcessingNotification = false;

    function showNotification(message, type = 'info', duration = 3000) {
      // Voeg nieuwe notificatie toe aan wachtrij
      notificationQueue.push({ message, type, duration });
      
      // Start verwerking als er nog geen notificatie wordt getoond
      if (!isProcessingNotification) {
        processNextNotification();
      }
    }

    function processNextNotification() {
      if (notificationQueue.length === 0) {
        isProcessingNotification = false;
        return;
      }

      isProcessingNotification = true;
      const { message, type, duration } = notificationQueue.shift();

      // Check op dubbele actieve notificaties
      const container = document.getElementById('notification-container');
      const activeNotifications = container.getElementsByClassName('notification');
      
      for (const notification of activeNotifications) {
        if (notification.textContent === message) {
          // Skip deze notificatie als dezelfde al wordt getoond
          processNextNotification();
          return;
        }
      }

      // Maak nieuwe notificatie
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;

      // Voeg toe aan container
      container.appendChild(notification);

      // Verwijder na timeout
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out forwards';
        setTimeout(() => {
          if (container.contains(notification)) {
            container.removeChild(notification);
          }
          // Verwerk volgende notificatie
          processNextNotification();
        }, 300);
      }, duration);
    }

    // Dark mode toggle functie
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDarkMode);
      
      // Update de tekst op de knop
      const modeText = document.querySelector('.mode-text');
      if (modeText) {
        modeText.textContent = isDarkMode ? 'Licht' : 'Donker';
      }
    }

    // Herstel dark mode voorkeur bij laden
    document.addEventListener('DOMContentLoaded', function() {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        const modeText = document.querySelector('.mode-text');
        if (modeText) {
          modeText.textContent = 'Licht';
        }
      }
    });

    // Data compressie helpers
    const compression = {
      compress: function(data) {
        try {
          const jsonString = JSON.stringify(data);
          // Gebruik base64 encoding voor betere compatibiliteit
          return btoa(jsonString);
        } catch (error) {
          console.error('Compressie fout:', error);
          return null;
        }
      },
      
      decompress: function(compressed) {
        try {
          if (!compressed) return null;
          const jsonString = atob(compressed);
          return JSON.parse(jsonString);
        } catch (error) {
          console.error('Decompressie fout:', error);
          return null;
        }
      }
    };

    // Verbeterde localStorage helpers met compressie
    function saveToLocalStorage(key, value) {
      try {
        // Check voor null of undefined waarden
        if (value === null || value === undefined) {
          throw new Error(`Ongeldige waarde voor ${key}`);
        }

        // Comprimeer de data
        const compressed = compression.compress(value);
        if (!compressed) {
          throw new Error('Compressie mislukt');
        }

        // Check grootte
        const size = new Blob([compressed]).size;
        if (size > 5242880) { // 5MB limiet
          throw new Error('Data is te groot voor localStorage');
        }

        // Sla op met timestamp
        const saveData = {
          data: compressed,
          timestamp: new Date().toISOString(),
          size: size
        };

        localStorage.setItem(key, JSON.stringify(saveData));

        // Verifieer opslag
        const stored = localStorage.getItem(key);
        if (!stored) {
          throw new Error('Data verificatie mislukt');
        }

        return true;
      } catch (error) {
        console.error(`Fout bij opslaan in localStorage (${key}):`, error);
        
        // Specifieke error handling
        if (error.name === 'QuotaExceededError' || 
            error.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
          showNotification('Opslag is vol. Exporteer en verwijder oude rapportages om ruimte te maken.', 'error', 5000);
        } else if (error.message === 'Data is te groot voor localStorage') {
          showNotification('De data is te groot om op te slaan. Overweeg om enkele rapportages te exporteren en verwijderen.', 'error', 5000);
        } else if (error.message === 'Data verificatie mislukt') {
          showNotification('Kon de data niet correct opslaan. Maak een backup om gegevensverlies te voorkomen.', 'error');
        } else {
          showNotification('Er ging iets mis bij het opslaan. Maak een backup van je werk.', 'error');
        }
        return false;
      }
    }

    function loadFromLocalStorage(key) {
      try {
        const stored = localStorage.getItem(key);
        if (!stored) return null;

        const saveData = JSON.parse(stored);
        if (!saveData.data) return null;

        // Decomprimeer de data
        const decompressed = compression.decompress(saveData.data);
        if (!decompressed) {
          throw new Error('Decompressie mislukt');
        }

        return decompressed;
      } catch (error) {
        console.error(`Fout bij laden uit localStorage (${key}):`, error);
        showNotification('Er ging iets mis bij het laden van opgeslagen data.', 'error');
        return null;
      }
    }

    function slaRapportageOp() {
      if (!globals.huidigeDeelnemer) return;
      
      const input = document.getElementById('input');
      if (!input) return;
      
      try {
        globals.rapportages[globals.huidigeDeelnemer] = input.value;
        saveToLocalStorage('rapportages', globals.rapportages);
        console.log(`Rapportage opgeslagen voor ${globals.huidigeDeelnemer}`);
      } catch (error) {
        console.error('Fout bij opslaan rapportage:', error);
        showNotification('Er ging iets mis bij het opslaan van de rapportage.', 'error');
      }
    }

    // Auto-save setup
    function setupAutoSave() {
      const input = document.getElementById('input');
      if (!input) return;
      
      input.addEventListener('input', () => {
        // Update de genereer knop status
        const genBtn = document.getElementById('genBtn');
        const heeftInput = input.value.trim() !== '';
        genBtn.disabled = !heeftInput;
        genBtn.classList.toggle('btn-disabled', !heeftInput);
        
        // Auto-save alleen als er een deelnemer is geselecteerd
        if (globals.huidigeDeelnemer) {
          clearTimeout(globals.autoSaveTimeout);
          globals.autoSaveTimeout = setTimeout(() => {
            slaRapportageOp();
            showNotification('Rapportage automatisch opgeslagen', 'success', 1000);
          }, 1000);
        }
      });
    }

    // Voeg auto-save toe bij laden
    document.addEventListener('DOMContentLoaded', function() {
      setupAutoSave();
    });

    // Toetsenbordsnelkoppelingen
    document.addEventListener('keydown', function(event) {
      // Alleen activeren als Alt-toets is ingedrukt
      if (event.altKey) {
        switch(event.key) {
          case 'g': // Alt+G: Genereer prompt
            event.preventDefault();
            if (!document.getElementById('genBtn').disabled) {
              genereerPrompt();
            }
            break;
          case 'a': // Alt+A: Genereer alle prompts
            event.preventDefault();
            genereerAllePrompts();
            break;
          case 'o': // Alt+O: Open in ChatGPT
            event.preventDefault();
            if (!document.getElementById('openChatGPTBtn').disabled) {
              openInChatGPT();
            }
            break;
          case 's': // Alt+S: Start opname
            event.preventDefault();
            if (!document.getElementById('startOpname').disabled) {
              startOpname();
            }
            break;
          case 'p': // Alt+P: Stop opname
            event.preventDefault();
            if (!document.getElementById('stopOpname').disabled) {
              stopOpname();
            }
            break;
          case 'm': // Alt+M: Toggle dark mode
            event.preventDefault();
            toggleDarkMode();
            break;
          case 'r': // Alt+R: Reset velden
            event.preventDefault();
            if (globals.huidigeDeelnemer) {
              clearInput();
            }
            break;
          case 'c': // Alt+C: Kopieer prompt
            event.preventDefault();
            if (!document.getElementById('copyPromptBtn').disabled) {
              kopieerPromptNaarKlembord();
            }
            break;
        }
      }
    });

    // Deelnemer wijzigen functie
    function wijzigDeelnemerNaam() {
      if (!globals.huidigeDeelnemer) {
        showNotification("Selecteer eerst een deelnemer.", "warning");
        return;
      }

      const nieuweNaam = prompt("Voer de nieuwe naam in voor " + globals.huidigeDeelnemer + ":");
      if (nieuweNaam && nieuweNaam.trim()) {
        const naam = nieuweNaam.trim();
        
        if (globals.deelnemers.includes(naam)) {
          showNotification("Deze naam bestaat al.", "warning");
          return;
        }

        try {
          // Update in arrays
          const index = globals.deelnemers.indexOf(globals.huidigeDeelnemer);
          globals.deelnemers[index] = naam;
          
          // Update rapportages
          globals.rapportages[naam] = globals.rapportages[globals.huidigeDeelnemer];
          delete globals.rapportages[globals.huidigeDeelnemer];
          
          // Update huidige deelnemer
          globals.huidigeDeelnemer = naam;
          
          // Sla op in localStorage
          saveToLocalStorage('deelnemers', globals.deelnemers);
          saveToLocalStorage('rapportages', globals.rapportages);
          
          // Update UI
          updateDeelnemersList();
          showNotification(`Naam gewijzigd naar "${naam}"`, "success");
        } catch (error) {
          console.error('Fout bij wijzigen naam:', error);
          showNotification('Er ging iets mis bij het wijzigen van de naam.', 'error');
        }
      }
    }

    // Deelnemer verwijderen functie
    function verwijderDeelnemer() {
      if (!globals.huidigeDeelnemer) {
        showNotification("Selecteer eerst een deelnemer.", "warning");
        return;
      }

      const bevestig = confirm(`Weet je zeker dat je ${globals.huidigeDeelnemer} wilt verwijderen? Dit kan niet ongedaan worden gemaakt.`);
      if (bevestig) {
        try {
          // Verwijder uit arrays
          const index = globals.deelnemers.indexOf(globals.huidigeDeelnemer);
          globals.deelnemers.splice(index, 1);
          delete globals.rapportages[globals.huidigeDeelnemer];
          
          // Sla op in localStorage
          saveToLocalStorage('deelnemers', globals.deelnemers);
          saveToLocalStorage('rapportages', globals.rapportages);
          
          // Reset huidige deelnemer
          globals.huidigeDeelnemer = '';
          document.getElementById('input').value = '';
          
          // Update UI
          updateDeelnemersList();
          showNotification("Deelnemer verwijderd", "success");
        } catch (error) {
          console.error('Fout bij verwijderen deelnemer:', error);
          showNotification('Er ging iets mis bij het verwijderen van de deelnemer.', 'error');
        }
      }
    }

    // Verbeterde spraakherkenning setup
    function setupSpeechRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        showNotification('Spraakherkenning wordt niet ondersteund. Gebruik Chrome voor de beste ervaring.', 'warning');
        return;
      }

      try {
        globals.recognition = new webkitSpeechRecognition();
        globals.recognition.continuous = true;
        globals.recognition.interimResults = true;
        globals.recognition.lang = 'nl-NL';
        
        let retryCount = 0;
        const maxRetries = 3;
        
        globals.recognition.onresult = function(event) {
          let interimTranscript = '';
          let finalTranscript = globals.permanenteTranscript;
          
          for (let i = event.resultIndex; i < event.results.length; ++i) {
            if (event.results[i].isFinal) {
              finalTranscript += event.results[i][0].transcript;
              globals.permanenteTranscript = finalTranscript;
              // Reset retry count bij succesvolle herkenning
              retryCount = 0;
            } else {
              interimTranscript += event.results[i][0].transcript;
            }
          }
          
          globals.laatsteInterimTranscript = interimTranscript;
          document.getElementById('input').value = finalTranscript + interimTranscript;
        };
        
        globals.recognition.onerror = function(event) {
          console.error('Spraakherkenning fout:', event.error);
          
          // Specifieke error handling
          switch(event.error) {
            case 'no-speech':
              if (retryCount < maxRetries) {
                retryCount++;
                showNotification(`Geen spraak gedetecteerd, probeer opnieuw (poging ${retryCount}/${maxRetries})`, 'warning');
                restartSpeechRecognition();
              } else {
                showNotification('Geen spraak gedetecteerd na meerdere pogingen', 'error');
                stopOpname();
              }
              break;
            case 'audio-capture':
              showNotification('Geen microfoon gevonden of toegang geweigerd', 'error');
              stopOpname();
              break;
            case 'not-allowed':
              showNotification('Toegang tot microfoon geweigerd. Check je browser instellingen.', 'error');
              stopOpname();
              break;
            case 'network':
              if (retryCount < maxRetries) {
                retryCount++;
                showNotification('Netwerkfout, probeer opnieuw te verbinden...', 'warning');
                setTimeout(restartSpeechRecognition, 1000);
              } else {
                showNotification('Netwerkproblemen blijven aanhouden', 'error');
                stopOpname();
              }
              break;
            default:
              if (retryCount < maxRetries) {
                retryCount++;
                showNotification('Er is een fout opgetreden, probeer opnieuw', 'warning');
                setTimeout(restartSpeechRecognition, 1000);
              } else {
                showNotification('Spraakherkenning gestopt vanwege aanhoudende problemen', 'error');
                stopOpname();
              }
          }
        };

        globals.recognition.onend = function() {
          if (globals.isOpnameActief) {
            restartSpeechRecognition();
          }
        };

      } catch (error) {
        console.error('Fout bij setup spraakherkenning:', error);
        showNotification('Er ging iets mis bij het instellen van de spraakherkenning', 'error');
      }
    }

    function restartSpeechRecognition() {
      if (globals.isOpnameActief) {
        try {
          globals.recognition.start();
        } catch (error) {
          console.error('Fout bij herstarten spraakherkenning:', error);
          stopOpname();
        }
      }
    }

    function startOpname() {
      const heeftMeerdereDeelnemers = globals.deelnemers.length > 1;
      
      if (heeftMeerdereDeelnemers && !globals.huidigeDeelnemer) {
        showNotification('Selecteer eerst een deelnemer voordat je een opname start', 'warning');
        return;
      }

      // Check of opname is toegestaan
      const geenDeelnemers = globals.deelnemers.length === 0;
      const enkeleDeelnemer = globals.deelnemers.length === 1;
      const magOpnemen = geenDeelnemers || enkeleDeelnemer || globals.huidigeDeelnemer;
      
      if (!magOpnemen) {
        showNotification('Selecteer eerst een deelnemer voordat je een opname start', 'warning');
        return;
      }

      // Check protocol en omgeving
      const protocol = window.location.protocol;
      const isLocalhost = window.location.hostname === 'localhost' || 
                         window.location.hostname === '127.0.0.1';
      const isFileProtocol = protocol === 'file:';
      const isHttps = protocol === 'https:';

      if (!isHttps && !isLocalhost && !isFileProtocol) {
        showNotification('Spraakherkenning vereist HTTPS of lokaal gebruik', 'warning');
        return;
      }

      if (!globals.recognition) {
        setupSpeechRecognition();
      }
      
      if (globals.recognition) {
        try {
          // Bewaar huidige tekst voordat we beginnen met opnemen
          const huidigeInput = document.getElementById('input').value;
          
          // Als er al tekst is, zorg voor spatie/nieuwe regel
          if (huidigeInput.trim()) {
            const laatsteChar = huidigeInput.charAt(huidigeInput.length - 1);
            if (laatsteChar !== ' ' && laatsteChar !== '\n') {
              globals.permanenteTranscript = huidigeInput + ' ';
            } else {
              globals.permanenteTranscript = huidigeInput;
            }
          } else {
            globals.permanenteTranscript = '';
          }
          
          globals.isOpnameActief = true;
          globals.recognition.start();
          
          // Update UI
          document.getElementById('startOpname').disabled = true;
          document.getElementById('stopOpname').disabled = false;
          document.getElementById('opnameIndicator').classList.add('active');
          
          // Update deelnemer indicator
          const deelnemerSpan = document.querySelector('.recording-deelnemer');
          if (deelnemerSpan) {
            if (globals.huidigeDeelnemer) {
              deelnemerSpan.textContent = globals.huidigeDeelnemer;
            } else if (enkeleDeelnemer) {
              deelnemerSpan.textContent = globals.deelnemers[0];
            } else {
              deelnemerSpan.textContent = 'Directe opname';
            }
          }
          
          // Start timer
          globals.opnameStartTijd = Date.now();
          updateOpnameTijd();
          globals.opnameTijdTimer = setInterval(updateOpnameTijd, 1000);
          
          showNotification('Opname gestart', 'success');
        } catch (error) {
          console.error('Fout bij starten opname:', error);
          showNotification('Er ging iets mis bij het starten van de opname: ' + error.message, 'error');
          stopOpname();
        }
      }
    }

    function stopOpname() {
      if (globals.recognition && globals.isOpnameActief) {
        try {
          globals.recognition.stop();
          globals.isOpnameActief = false;
          
          // Update UI
          document.getElementById('startOpname').disabled = false;
          document.getElementById('stopOpname').disabled = true;
          document.getElementById('opnameIndicator').classList.remove('active');
          
          // Stop timer
          clearInterval(globals.opnameTijdTimer);
          globals.opnameStartTijd = null;
          
          // Sla de huidige tekst op voor de huidige deelnemer
          if (globals.huidigeDeelnemer) {
            slaRapportageOp();
          }
          
          showNotification('Opname gestopt en rapportage opgeslagen', 'info');
        } catch (error) {
          console.error('Fout bij stoppen opname:', error);
          showNotification('Er ging iets mis bij het stoppen van de opname.', 'error');
        }
      }
    }

    function updateOpnameTijd() {
      if (!globals.opnameStartTijd) return;
      
      const verstrekenTijd = Math.floor((Date.now() - globals.opnameStartTijd) / 1000);
      const minuten = Math.floor(verstrekenTijd / 60);
      const seconden = verstrekenTijd % 60;
      
      document.getElementById('opnameTijd').textContent = 
        `${minuten.toString().padStart(2, '0')}:${seconden.toString().padStart(2, '0')}`;
    }

    function genereerPrompt() {
      const input = document.getElementById('input').value.trim();
      if (!input) {
        showNotification('Voer eerst een observatie in', 'warning');
        return;
      }

      const keuze = document.getElementById('keuze').value;
      const methode = document.getElementById('methode').value;
      let basis = '';

      if (keuze === "taal") {
        basis = "Controleer enkel op spelling, grammatica en zinsbouw – de inhoud blijft hetzelfde.\n\n";
      } else if (keuze === "suggesties") {
        basis = "Geef 3 alternatieve formuleringen voor onderstaande tekst die duidelijker of professioneler kunnen zijn. Behoud wel de kernboodschap.\n\n";
      } else if (keuze === "combi") {
        basis = "Controleer op spelling, grammatica en zinsopbouw, zonder de betekenis of letterlijke uitspraken te veranderen. Herschrijf zinnen indien nodig voor meer duidelijkheid of betere stijl. Inhoud blijft leidend.\n\n";
      }

      // Privacyherinnering toevoegen
      basis += "Let op: vervang eventuele persoonlijke identificeerbare informatie als volledige namen door initialen of aanduidingen als 'cliënt'.\n\n";

      if (methode === "objectief") {
        globals.huidigePrompt = basis +
          "Herschrijf onderstaande observatie in objectieve stijl.\n" +
          "Vermijd interpretatie of subjectieve taal.\n\n" +
          "Tekst:\n" + input;
      } else {
        globals.huidigePrompt = basis +
          "Herschrijf onderstaande observatie volgens de SOEP-methodiek:\n" +
          "S = Subjectief (ervaring/beleving van cliënt),\n" +
          "O = Objectief (wat je ziet, hoort, ruikt of meet),\n" +
          "E = Evaluatie (jouw professionele inschatting),\n" +
          "P = Plan (wat je hiermee doet of opvolgt).\n\n" +
          "Tekst:\n" + input;
      }

      document.getElementById("output").textContent = globals.huidigePrompt;
      document.getElementById("output").scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      // Enable de ChatGPT en kopieer knoppen
      const openChatGPTBtn = document.getElementById('openChatGPTBtn');
      const copyPromptBtn = document.getElementById('copyPromptBtn');
      openChatGPTBtn.disabled = false;
      copyPromptBtn.disabled = false;
      openChatGPTBtn.classList.remove('btn-disabled');
      copyPromptBtn.classList.remove('btn-disabled');
      
      showNotification('Prompt gegenereerd!', 'success');
    }

    function genereerAllePrompts() {
      if (globals.deelnemers.length === 0) {
        showNotification('Er zijn nog geen deelnemers toegevoegd', 'warning');
        return;
      }

      let allePrompts = '';
      globals.deelnemers.forEach(deelnemer => {
        const rapportage = globals.rapportages[deelnemer];
        if (rapportage && rapportage.trim()) {
          allePrompts += `=== Rapportage voor ${deelnemer} ===\n\n${rapportage}\n\n`;
        }
      });

      if (!allePrompts) {
        showNotification('Geen rapportages gevonden om te verwerken', 'warning');
        return;
      }

      // Gebruik exact dezelfde code als in genereerPrompt functie
      const keuze = document.getElementById('keuze').value;
      const methode = document.getElementById('methode').value;
      let basis = '';

      // Exact dezelfde basis opties als in genereerPrompt
      if (keuze === "taal") {
        basis = "Controleer enkel op spelling, grammatica en zinsbouw – de inhoud blijft hetzelfde.\n\n";
      } else if (keuze === "suggesties") {
        basis = "Geef 3 alternatieve formuleringen voor onderstaande tekst die duidelijker of professioneler kunnen zijn. Behoud wel de kernboodschap.\n\n";
      } else if (keuze === "combi") {
        basis = "Controleer op spelling, grammatica en zinsopbouw, zonder de betekenis of letterlijke uitspraken te veranderen. Herschrijf zinnen indien nodig voor meer duidelijkheid of betere stijl. Inhoud blijft leidend.\n\n";
      }

      // Voeg privacy herinnering toe, exact als in genereerPrompt
      basis += "Let op: vervang eventuele persoonlijke identificeerbare informatie als volledige namen door initialen of aanduidingen als 'cliënt'.\n\n";

      // Voeg methodiek instructies toe, aangepast voor meerdere rapportages
      if (methode === "objectief") {
        basis += "Herschrijf onderstaande observaties in objectieve stijl.\n" +
                "Vermijd interpretatie of subjectieve taal.\n\n";
      } else {
        basis += "Herschrijf onderstaande observaties volgens de SOEP-methodiek:\n" +
                "S = Subjectief (ervaring/beleving van cliënt),\n" +
                "O = Objectief (wat je ziet, hoort, ruikt of meet),\n" +
                "E = Evaluatie (jouw professionele inschatting),\n" +
                "P = Plan (wat je hiermee doet of opvolgt).\n\n";
      }

      // Voeg tekst label toe
      globals.huidigePrompt = basis + "Tekst:\n" + allePrompts;
      
      // Update UI
      document.getElementById("output").textContent = globals.huidigePrompt;
      document.getElementById("output").scrollIntoView({ behavior: 'smooth', block: 'start' });
      showNotification('Alle rapportages verwerkt met ' + keuze + ' methode!', 'success');
    }

    function openInChatGPT() {
      if (!globals.huidigePrompt) {
        showNotification("Genereer eerst een prompt", "warning");
        return;
      }

      // Toon de overlay
      document.getElementById('promptOverlay').style.display = 'flex';
    }

    function sluitOverlay() {
      document.getElementById('promptOverlay').style.display = 'none';
      document.getElementById('copyStatus').textContent = '';
    }

    function kopieerPrompt() {
      const textArea = document.createElement('textarea');
      textArea.value = globals.huidigePrompt;
      document.body.appendChild(textArea);
      textArea.select();
      
      try {
        document.execCommand('copy');
        document.getElementById('copyStatus').textContent = '✓ Prompt gekopieerd!';
        document.getElementById('copyStatus').style.color = 'var(--success)';
      } catch (err) {
        console.error('Fout bij kopiëren:', err);
        document.getElementById('copyStatus').textContent = '× Kopiëren mislukt';
        document.getElementById('copyStatus').style.color = 'var(--danger)';
      } finally {
        document.body.removeChild(textArea);
      }
    }

    function openChatGPTVanuitOverlay() {
      const chatGPTUrl = 'https://chat.openai.com/';
      const w = window.open(chatGPTUrl, '_blank');
      
      if (w) {
        sluitOverlay();
        showNotification("ChatGPT geopend in nieuw tabblad", "success");
      } else {
        showNotification("Popup blocker verhindert het openen van ChatGPT", "error");
      }
    }

    // Backup functionaliteit
    function maakBackup() {
      try {
        // Valideer data voor backup
        if (!Array.isArray(globals.deelnemers)) {
          throw new Error('Ongeldige deelnemers data');
        }
        
        if (!globals.rapportages || typeof globals.rapportages !== 'object') {
          throw new Error('Ongeldige rapportages data');
        }

        // Maak backup object
        const backupData = {
          deelnemers: globals.deelnemers,
          rapportages: globals.rapportages,
          datum: new Date().toISOString(),
          versie: '1.0',
          metadata: {
            aantalDeelnemers: globals.deelnemers.length,
            aantalRapportages: Object.keys(globals.rapportages).length,
            platform: navigator.platform,
            userAgent: navigator.userAgent
          }
        };

        // Converteer naar JSON met formatting
        const backupString = JSON.stringify(backupData, null, 2);
        
        // Genereer unieke bestandsnaam
        const datum = new Date().toISOString().replace(/[:.]/g, '-');
        const fileName = `rapportage_backup_${datum}.json`;

        // Maak en download het bestand
        const blob = new Blob([backupString], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        
        // Voeg toe aan DOM, klik en verwijder
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        // Cleanup
        window.URL.revokeObjectURL(url);

        // Toon succes melding met details
        const msg = `Backup succesvol gemaakt met ${backupData.metadata.aantalDeelnemers} deelnemer(s) en ${backupData.metadata.aantalRapportages} rapportage(s)!`;
        showNotification(msg, 'success');
        
        return true;
      } catch (error) {
        console.error('Fout bij maken backup:', error);
        
        // Specifieke error meldingen
        if (error.message === 'Ongeldige deelnemers data') {
          showNotification('Kon geen backup maken: ongeldige deelnemersdata', 'error');
        } else if (error.message === 'Ongeldige rapportages data') {
          showNotification('Kon geen backup maken: ongeldige rapportagedata', 'error');
        } else {
          showNotification('Er ging iets mis bij het maken van de backup. Probeer het opnieuw.', 'error');
        }
        
        return false;
      }
    }

    function laadBackup(input) {
      const file = input.files[0];
      if (!file) {
        showNotification('Geen bestand geselecteerd', 'warning');
        return;
      }

      // Controleer bestandstype
      if (!file.name.toLowerCase().endsWith('.json')) {
        showNotification('Alleen JSON backup bestanden worden ondersteund. Selecteer een .json bestand.', 'warning');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          let backupData;
          try {
            backupData = JSON.parse(e.target.result);
          } catch (parseError) {
            showNotification('Het bestand is geen geldig JSON bestand. Controleer of je het juiste backup bestand hebt geselecteerd.', 'error');
            console.error('Parse error:', parseError);
            return;
          }

          // Log de ontvangen data voor debug doeleinden
          console.log('Ontvangen backup data:', backupData);
          
          // Converteer oude backup formaten naar het nieuwe formaat
          backupData = converteerBackupFormaat(backupData);
          
          // Valideer de geconverteerde data
          const validatieResultaat = valideerBackupData(backupData);
          if (!validatieResultaat.isGeldig) {
            showNotification(`Probleem met backup data: ${validatieResultaat.fout}`, 'error');
            return;
          }

          // Vraag om bevestiging met details
          const aantalDeelnemers = backupData.deelnemers.length;
          const aantalRapportages = Object.keys(backupData.rapportages).length;
          if (!confirm(
            `Deze backup bevat:\n` +
            `- ${aantalDeelnemers} deelnemer(s)\n` +
            `- ${aantalRapportages} rapportage(s)\n\n` +
            `Dit zal alle huidige data vervangen. Wil je doorgaan?`
          )) {
            return;
          }

          // Maak backup van huidige data
          const huidigeBackup = {
            deelnemers: globals.deelnemers,
            rapportages: globals.rapportages,
            datum: new Date().toISOString(),
            versie: '1.0'
          };
          
          try {
            localStorage.setItem('laatste_backup_voor_herstel', JSON.stringify(huidigeBackup));
          } catch (backupError) {
            console.warn('Kon geen backup maken van huidige data:', backupError);
          }

          // Update globals met gevalideerde data
          globals.deelnemers = backupData.deelnemers;
          globals.rapportages = backupData.rapportages;
          
          // Sla op in localStorage
          try {
            saveToLocalStorage('deelnemers', globals.deelnemers);
            saveToLocalStorage('rapportages', globals.rapportages);
          } catch (storageError) {
            showNotification('Waarschuwing: Kon niet alle data opslaan in localStorage. Mogelijk is de data te groot.', 'warning');
          }
          
          // Reset huidige deelnemer
          globals.huidigeDeelnemer = '';
          document.getElementById('input').value = '';
          
          // Update UI
          updateDeelnemersList();
          
          showNotification(
            `Backup succesvol hersteld! ${aantalDeelnemers} deelnemer(s) en ${aantalRapportages} rapportage(s) geladen.`, 
            'success'
          );
          
          // Toon extra melding over backup
          showNotification(
            'Er is een backup gemaakt van de vorige data. Gebruik "Reset alles" en "Herstel" om terug te gaan als nodig.',
            'info',
            5000
          );
          
        } catch (error) {
          console.error('Fout bij laden backup:', error);
          showNotification('Er ging iets mis bij het laden van de backup. Controleer het bestand en probeer opnieuw.', 'error');
        }
      };
      
      reader.onerror = function(error) {
        console.error('Fout bij lezen bestand:', error);
        showNotification('Kon het bestand niet lezen. Controleer of het bestand niet beschadigd is.', 'error');
      };
      
      reader.readAsText(file);
      input.value = '';
    }

    // Helper functie voor het converteren van verschillende backup formaten
    function converteerBackupFormaat(data) {
      // Als het al het nieuwe formaat is, return direct
      if (Array.isArray(data.deelnemers) && typeof data.rapportages === 'object') {
        return data;
      }

      console.log('Converteren van backup formaat...', data);

      let deelnemers = [];
      let rapportages = {};

      // Scenario 1: Oude format waar deelnemers een object was
      if (typeof data.deelnemers === 'object' && !Array.isArray(data.deelnemers)) {
        deelnemers = Object.keys(data.deelnemers);
      }
      
      // Scenario 2: Deelnemers direct in root van backup
      if (typeof data === 'object' && !data.deelnemers && !data.rapportages) {
        Object.keys(data).forEach(key => {
          if (typeof data[key] === 'string' || Array.isArray(data[key])) {
            deelnemers.push(key);
            rapportages[key] = data[key];
          }
        });
      }

      // Scenario 3: Rapportages in oude formaat (direct string ipv array)
      if (typeof data.rapportages === 'object') {
        Object.entries(data.rapportages).forEach(([deelnemer, rapportage]) => {
          if (typeof rapportage === 'string') {
            rapportages[deelnemer] = [{
              tekst: rapportage,
              datum: new Date().toISOString(),
              laatst_bijgewerkt: new Date().toISOString(),
              methode: 'objectief'
            }];
          } else if (Array.isArray(rapportage)) {
            rapportages[deelnemer] = rapportage;
          }
        });
      }

      // Zorg dat alle deelnemers uit rapportages ook in de deelnemerslijst staan
      Object.keys(rapportages).forEach(deelnemer => {
        if (!deelnemers.includes(deelnemer)) {
          deelnemers.push(deelnemer);
        }
      });

      // Zorg dat alle deelnemers een rapportage entry hebben
      deelnemers.forEach(deelnemer => {
        if (!rapportages[deelnemer]) {
          rapportages[deelnemer] = [];
        }
      });

      const geconverteerdData = {
        deelnemers: deelnemers,
        rapportages: rapportages,
        datum: data.datum || new Date().toISOString(),
        versie: '1.0'
      };

      console.log('Geconverteerde data:', geconverteerdData);
      return geconverteerdData;
    }

    // Helper functie voor backup validatie
    function valideerBackupData(data) {
      try {
        // Basis validatie
        if (!data || typeof data !== 'object') {
          return { isGeldig: false, fout: 'Backup data heeft een ongeldig formaat.' };
        }

        // Controleer of we deelnemers kunnen vinden/maken
        const heeftDeelnemers = Array.isArray(data.deelnemers) || 
                               (typeof data === 'object' && Object.keys(data).length > 0);
        
        if (!heeftDeelnemers) {
          return { isGeldig: false, fout: 'Geen deelnemers gevonden in het backup bestand.' };
        }

        // Als de data geconverteerd is, zou het nu het juiste formaat moeten hebben
        if (!Array.isArray(data.deelnemers)) {
          return { isGeldig: false, fout: 'Deelnemerslijst heeft een ongeldig formaat na conversie.' };
        }

        // Controleer individuele deelnemers
        const ongeldigeDeelnemer = data.deelnemers.find(d => typeof d !== 'string' || !d.trim());
        if (ongeldigeDeelnemer !== undefined) {
          return { isGeldig: false, fout: 'Er zijn ongeldige deelnemernamen gevonden.' };
        }

        // Controleer rapportages
        if (!data.rapportages || typeof data.rapportages !== 'object') {
          return { isGeldig: false, fout: 'Rapportages hebben een ongeldig formaat.' };
        }

        // Controleer individuele rapportages
        for (const [deelnemer, rapportages] of Object.entries(data.rapportages)) {
          if (typeof deelnemer !== 'string' || !deelnemer.trim()) {
            return { isGeldig: false, fout: 'Ongeldige deelnemer gevonden in rapportages.' };
          }

          if (!Array.isArray(rapportages) && typeof rapportages !== 'string') {
            return { isGeldig: false, fout: `Ongeldig rapportage formaat voor ${deelnemer}.` };
          }
        }

        return { isGeldig: true, fout: null };
      } catch (error) {
        console.error('Validatie error:', error);
        return { isGeldig: false, fout: 'Er ging iets mis bij het valideren van de backup data.' };
      }
    }

    // Reset functionaliteit
    function resetAlles() {
      if (!confirm('Weet je zeker dat je ALLE rapportages en deelnemers wilt verwijderen? Dit kan niet ongedaan worden gemaakt!')) {
        return;
      }
      
      try {
        // Maak eerst een backup voor de zekerheid
        const backupData = {
          deelnemers: globals.deelnemers,
          rapportages: globals.rapportages,
          datum: new Date().toISOString(),
          versie: '1.0'
        };
        
        const backupString = JSON.stringify(backupData, null, 2);
        const blob = new Blob([backupString], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        const datum = new Date().toISOString().split('T')[0];
        a.href = url;
        a.download = `rapportage_backup_voor_reset_${datum}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        // Reset alle data
        globals.deelnemers = [];
        globals.rapportages = {};
        globals.huidigeDeelnemer = '';
        
        // Wis localStorage
        localStorage.removeItem('deelnemers');
        localStorage.removeItem('rapportages');
        
        // Reset UI
        document.getElementById('input').value = '';
        document.getElementById('output').textContent = '';
        updateDeelnemersList();
        
        showNotification('Alle rapportages en deelnemers zijn verwijderd. Er is een backup gemaakt voor de zekerheid.', 'success');
      } catch (error) {
        console.error('Fout bij reset:', error);
        showNotification('Er ging iets mis bij het resetten van de data.', 'error');
      }
    }

    // Functie om tekst te wissen
    function clearInput() {
      if (!globals.huidigeDeelnemer) {
        showNotification('Selecteer eerst een deelnemer voordat je de tekst wist', 'warning');
        return;
      }
      
      document.getElementById('input').value = '';
      showNotification('Tekst gewist', 'info');
    }

    // Functie om donatieknoppen te tonen
    function toonDonatieOpties() {
      const donatieMenu = document.getElementById('donatie-opties');
      if (donatieMenu.style.display === 'flex') {
        donatieMenu.style.display = 'none';
      } else {
        donatieMenu.style.display = 'flex';
      }
      
      // Sluit het menu wanneer ergens anders wordt geklikt
      document.addEventListener('click', function closeMenu(event) {
        const donateButton = document.querySelector('.donate-button');
        const clickedOnButton = donateButton.contains(event.target);
        const clickedOnMenu = donatieMenu.contains(event.target);
        
        if (!clickedOnButton && !clickedOnMenu) {
          donatieMenu.style.display = 'none';
          document.removeEventListener('click', closeMenu);
        }
      });
    }

    // Voeg deze nieuwe functie toe bij de andere JavaScript functies
    function kopieerPromptNaarKlembord() {
      if (!globals.huidigePrompt) {
        showNotification("Genereer eerst een prompt", "warning");
        return;
      }

      const textArea = document.createElement('textarea');
      textArea.value = globals.huidigePrompt;
      document.body.appendChild(textArea);
      textArea.select();
      
      try {
        document.execCommand('copy');
        showNotification("✓ Prompt gekopieerd naar klembord!", "success");
      } catch (err) {
        console.error('Fout bij kopiëren:', err);
        showNotification("Kon de prompt niet kopiëren", "error");
      } finally {
        document.body.removeChild(textArea);
      }
    }

    // DOM element cache systeem
    const domCache = {
      elements: {},
      get: function(id) {
        if (!this.elements[id]) {
          this.elements[id] = document.getElementById(id);
        }
        return this.elements[id];
      },
      clear: function() {
        this.elements = {};
      },
      refresh: function(id) {
        this.elements[id] = document.getElementById(id);
        return this.elements[id];
      }
    };

    // Helper functie voor vaak gebruikte elementen
    function getElement(id) {
      return domCache.get(id);
    }

    // Vervang document.getElementById calls door getElement
    function updateUI() {
      const input = getElement('input');
      const genBtn = getElement('genBtn');
      const copyPromptBtn = getElement('copyPromptBtn');
      const openChatGPTBtn = getElement('openChatGPTBtn');
      const genAlleBtn = getElement('genAlleBtn'); // Nieuwe regel
      
      // Update button states
      const heeftInput = input && input.value.trim() !== '';
      const heeftDeelnemers = globals.deelnemers && globals.deelnemers.length > 0;
      
      if (genBtn) {
        genBtn.disabled = !heeftInput;
        genBtn.classList.toggle('btn-disabled', !heeftInput);
      }

      // Update genAlleBtn status
      if (genAlleBtn) {
        genAlleBtn.disabled = !heeftInput || !heeftDeelnemers;
        genAlleBtn.classList.toggle('btn-disabled', !heeftInput || !heeftDeelnemers);
        
        // Update tooltip
        if (!heeftDeelnemers) {
          genAlleBtn.title = "Voeg eerst deelnemers toe";
        } else if (!heeftInput) {
          genAlleBtn.title = "Voer eerst tekst in";
        } else {
          genAlleBtn.title = "Genereer AI-prompt voor alle deelnemers";
        }
      }

      if (copyPromptBtn && openChatGPTBtn) {
        const heeftPrompt = globals.huidigePrompt && globals.huidigePrompt.trim() !== '';
        copyPromptBtn.disabled = !heeftPrompt;
        openChatGPTBtn.disabled = !heeftPrompt;
        copyPromptBtn.classList.toggle('btn-disabled', !heeftPrompt);
        openChatGPTBtn.classList.toggle('btn-disabled', !heeftPrompt);
      }

      // Update opname controls
      if (startOpname && stopOpname) {
        startOpname.disabled = globals.isOpnameActief;
        stopOpname.disabled = !globals.isOpnameActief;
      }

      // Update opname indicator
      if (opnameIndicator) {
        opnameIndicator.classList.toggle('active', globals.isOpnameActief);
      }
    }

    // Voeg deze functie toe aan de initialisatie
    document.addEventListener('DOMContentLoaded', function() {
      // Cache vaak gebruikte elementen
      ['input', 'genBtn', 'copyPromptBtn', 'openChatGPTBtn', 'deelnemerSelect', 
       'startOpname', 'stopOpname', 'output', 'opnameIndicator'].forEach(id => {
        domCache.get(id);
      });
      
      // Rest van de initialisatie code...
    });

    // Error tracking systeem
    const errorTracker = {
      errors: [],
      maxErrors: 50,
      
      log: function(error, context = {}) {
        const errorInfo = {
          timestamp: new Date().toISOString(),
          message: error.message || error,
          stack: error.stack,
          type: error.name || 'Error',
          context: context,
          userAgent: navigator.userAgent,
          url: window.location.href
        };
        
        this.errors.unshift(errorInfo);
        
        // Behoud maximaal aantal errors
        if (this.errors.length > this.maxErrors) {
          this.errors.pop();
        }
        
        // Log naar console
        console.error('Error geregistreerd:', errorInfo);
        
        // Toon notificatie aan gebruiker indien ernstig
        if (this.isErnstigeError(error)) {
          showNotification('Er is een ernstige fout opgetreden. Maak een backup van je werk.', 'error', 5000);
        }
        
        return errorInfo;
      },
      
      isErnstigeError: function(error) {
        const ernstigeTypes = [
          'QuotaExceededError',
          'NS_ERROR_DOM_QUOTA_REACHED',
          'SecurityError',
          'SyntaxError'
        ];
        return ernstigeTypes.includes(error.name) || error.message.includes('storage') || error.message.includes('quota');
      },
      
      getErrors: function() {
        return this.errors;
      },
      
      clear: function() {
        this.errors = [];
      },
      
      exportErrors: function() {
        return {
          timestamp: new Date().toISOString(),
          errors: this.errors,
          userAgent: navigator.userAgent,
          url: window.location.href
        };
      }
    };

    // Globale error handler
    window.onerror = function(msg, url, lineNo, columnNo, error) {
      errorTracker.log(error || msg, {
        url: url,
        line: lineNo,
        column: columnNo
      });
      return false;
    };

    // Unhandled promise rejection handler
    window.onunhandledrejection = function(event) {
      errorTracker.log(event.reason, {
        type: 'UnhandledPromiseRejection'
      });
    };

    // Debug logging met error tracking
    function debugLog(message, data = {}) {
      try {
        console.log(`[DEBUG] ${message}`, data);
        
        // Check voor potentiële problemen
        if (data && typeof data === 'object') {
          const size = new Blob([JSON.stringify(data)]).size;
          if (size > 1048576) { // 1MB
            errorTracker.log(new Error('Grote debug data gedetecteerd'), {
              message: message,
              dataSize: size
            });
          }
        }
      } catch (error) {
        errorTracker.log(error, {
          message: 'Fout in debugLog',
          originalMessage: message
        });
      }
    }

    // Versie-controle functionaliteit
    async function checkVoorUpdates() {
      try {
        const response = await fetch('versie.json');
        const versieInfo = await response.json();
        
        // Update huidige versie weergave
        document.getElementById('current-version').textContent = versieInfo.versie;
        
        // Controleer op updates (hier zou je normaal een API-call maken)
        // Voor nu simuleren we dit met localStorage
        const laatstGecontroleerdeDatum = localStorage.getItem('laatstGecontroleerdeDatum');
        const vandaag = new Date().toISOString().split('T')[0];
        
        if (laatstGecontroleerdeDatum !== vandaag) {
          // Sla nieuwe controledatum op
          localStorage.setItem('laatstGecontroleerdeDatum', vandaag);
          
          // Hier zou je kunnen vergelijken met een externe versie
          // Voor nu tonen we de notificatie alleen bij de eerste keer laden per dag
          const heeftUpdateGezien = localStorage.getItem('heeftUpdateGezien');
          if (!heeftUpdateGezien) {
            document.getElementById('update-notification').classList.add('show');
            localStorage.setItem('heeftUpdateGezien', 'true');
          }
        }
      } catch (error) {
        console.error('Fout bij het controleren op updates:', error);
      }
    }

    // Controleer op updates bij het laden van de pagina
    window.addEventListener('load', checkVoorUpdates);

    // Versie-controle en update functionaliteit
    const REMOTE_VERSION_URL = 'https://raw.githubusercontent.com/Ahatsuki-Studios/RAP-Tool/main/assets/versie.json';
    const REMOTE_CHANGELOG_URL = 'https://raw.githubusercontent.com/Ahatsuki-Studios/RAP-Tool/main/assets/CHANGELOG.md';
    
    async function haalRemoteVersieOp() {
      try {
        // Voor lokale ontwikkeling, gebruik lokale versie.json
        const response = await fetch('assets/versie.json');
        if (!response.ok) throw new Error('Kon versie-informatie niet ophalen');
        return await response.json();
      } catch (error) {
        console.error('Fout bij ophalen versie:', error);
        toonFoutmelding('Kon versie-informatie niet ophalen. Controleer je internetverbinding.');
        return null;
      }
    }

    async function haalChangelogOp() {
      try {
        const response = await fetch('assets/CHANGELOG.md');
        if (!response.ok) throw new Error('Kon changelog niet ophalen');
        return await response.text();
      } catch (error) {
        console.error('Fout bij ophalen changelog:', error);
        return null;
      }
    }

    function vergelijkVersies(huidigeVersie, nieuweVersie) {
      const huidig = huidigeVersie.split('.').map(Number);
      const nieuw = nieuweVersie.split('.').map(Number);
      
      for (let i = 0; i < 3; i++) {
        if (nieuw[i] > huidig[i]) return true;
        if (nieuw[i] < huidig[i]) return false;
      }
      return false;
    }

    async function checkVoorUpdates() {
      const versieInfo = await haalRemoteVersieOp();
      if (!versieInfo) return;

      // Update huidige versie weergave
      document.getElementById('current-version').textContent = versieInfo.versie;

      // Check voor updates (in productie zou dit de remote versie ophalen)
      const laatstGecontroleerdeDatum = localStorage.getItem('laatstGecontroleerdeDatum');
      const vandaag = new Date().toISOString().split('T')[0];
      
      if (laatstGecontroleerdeDatum !== vandaag) {
        localStorage.setItem('laatstGecontroleerdeDatum', vandaag);
        
        // Simuleer een nieuwe versie (in productie zou dit de echte vergelijking zijn)
        const heeftNieuweVersie = vergelijkVersies(versieInfo.versie, "1.1.0");
        if (heeftNieuweVersie) {
          document.getElementById('update-banner').classList.add('show');
        }
      }
    }

    function toonFoutmelding(bericht) {
      const errorElement = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');
      errorText.textContent = bericht;
      errorElement.classList.add('show');
      setTimeout(() => errorElement.classList.remove('show'), 5000);
    }

    async function toonChangelog() {
      const modal = document.getElementById('changelog-modal');
      const content = document.getElementById('changelog-content');
      
      modal.classList.add('show');
      
      try {
        const changelogText = await haalChangelogOp();
        
        if (!changelogText) {
          content.innerHTML = `
            <div class="changelog-error">
              <span class="material-icons" style="margin-right: 0.5rem;">error_outline</span>
              Kon de wijzigingsgeschiedenis niet laden. Probeer het later opnieuw.
            </div>
          `;
          return;
        }
        
        // Eenvoudige Markdown naar HTML conversie
        const html = changelogText
          .replace(/^### (.*$)/gim, '<h3>$1</h3>')
          .replace(/^## (.*$)/gim, '<h2>$1</h2>')
          .replace(/^# (.*$)/gim, '<h1>$1</h1>')
          .replace(/^\- (.*$)/gim, '<li>$1</li>')
          .replace(/\n\n/g, '<br>');
        
        content.innerHTML = html;
      } catch (error) {
        content.innerHTML = `
          <div class="changelog-error">
            <span class="material-icons" style="margin-right: 0.5rem;">error_outline</span>
            Er is een fout opgetreden bij het laden van de wijzigingsgeschiedenis.
          </div>
        `;
      }
    }

    function sluitChangelog() {
      document.getElementById('changelog-modal').classList.remove('show');
    }

    function laadNieuweVersie() {
      // In een echte implementatie zou dit de nieuwe versie downloaden/installeren
      location.reload();
    }

    // Event listeners
    window.addEventListener('load', checkVoorUpdates);
    
    // Sluit modal bij klik buiten de content
    document.getElementById('changelog-modal').addEventListener('click', (e) => {
      if (e.target.id === 'changelog-modal') sluitChangelog();
    });

    // Verwijder oude versie-badge elementen
    document.addEventListener('DOMContentLoaded', function() {
      const oudeVersieElements = document.querySelectorAll('.version-info, .version-badge[style*="position: absolute"]');
      oudeVersieElements.forEach(el => el.remove());
    });

    // Versie-controle configuratie
    const CONFIG = {
      checkInterval: 24 * 60 * 60 * 1000, // 24 uur in milliseconden
      storage: {
        laatsteCheck: 'laatsteVersieCheck',
        laatsteVersie: 'laatsteBekendeVersie',
        cached: 'gecachedeChangelog'
      }
    };

    // Check netwerk status
    function isOnline() {
      return navigator.onLine;
    }

    // Update offline indicator
    function updateOfflineStatus() {
      const offlineIndicator = document.querySelector('.offline-indicator');
      if (offlineIndicator) {
        if (!isOnline()) {
          offlineIndicator.classList.add('show');
        } else {
          offlineIndicator.classList.remove('show');
        }
      }
    }

    // Versie vergelijking
    function vergelijkVersies(huidigeVersie, nieuweVersie) {
      const huidig = huidigeVersie.split('.').map(Number);
      const nieuw = nieuweVersie.split('.').map(Number);
      
      for (let i = 0; i < 3; i++) {
        if (nieuw[i] > huidig[i]) return true;
        if (nieuw[i] < huidig[i]) return false;
      }
      return false;
    }

    // Haal remote versie op met caching
    async function haalRemoteVersieOp() {
      try {
        if (!isOnline()) {
          const gecachedeVersie = localStorage.getItem(CONFIG.storage.laatsteVersie);
          if (gecachedeVersie) {
            return JSON.parse(gecachedeVersie);
          }
          throw new Error('Offline en geen gecachede versie beschikbaar');
        }

        // Haal versie op met cache-busting parameter
        const response = await fetch('assets/versie.json?t=' + new Date().getTime());
        if (!response.ok) throw new Error('Kon versie-informatie niet ophalen');
        const versieInfo = await response.json();
        
        // Cache de versie
        localStorage.setItem(CONFIG.storage.laatsteVersie, JSON.stringify(versieInfo));
        return versieInfo;
      } catch (error) {
        console.error('Fout bij ophalen versie:', error);
        throw error;
      }
    }

    // Haal changelog op met caching
    async function haalChangelogOp() {
      try {
        if (!isOnline()) {
          const gecachedeChangelog = localStorage.getItem(CONFIG.storage.cached);
          if (gecachedeChangelog) {
            return gecachedeChangelog;
          }
          throw new Error('Offline en geen gecachede changelog beschikbaar');
        }

        // Haal changelog op met cache-busting parameter
        const response = await fetch('assets/CHANGELOG.md?t=' + new Date().getTime());
        if (!response.ok) throw new Error('Kon changelog niet ophalen');
        const changelogText = await response.text();
        
        // Cache de changelog
        localStorage.setItem(CONFIG.storage.cached, changelogText);
        return changelogText;
      } catch (error) {
        console.error('Fout bij ophalen changelog:', error);
        return null;
      }
    }

    // Controleer op updates
    async function checkVoorUpdates(forceerCheck = false) {
      try {
        const laatsteCheck = localStorage.getItem(CONFIG.storage.laatsteCheck);
        const nuTijd = Date.now();
        
        // Skip check als het te kort geleden is, tenzij geforceerd
        if (!forceerCheck && laatsteCheck && (nuTijd - parseInt(laatsteCheck) < CONFIG.checkInterval)) {
          // Toon wel de gecachede versie
          const gecachedeVersie = localStorage.getItem(CONFIG.storage.laatsteVersie);
          if (gecachedeVersie) {
            const versieInfo = JSON.parse(gecachedeVersie);
            document.getElementById('current-version').textContent = versieInfo.versie;
          }
          return;
        }

        // Haal versie-info op en update UI
        const versieInfo = await haalRemoteVersieOp();
        if (!versieInfo) return;

        document.getElementById('current-version').textContent = versieInfo.versie;
        localStorage.setItem(CONFIG.storage.laatsteCheck, nuTijd.toString());

        // Check voor updates (in een echte implementatie vergelijk je met een remote versie)
        // Voor nu vergelijken we met "1.1.0" (huidige versie)
        const heeftNieuweVersie = vergelijkVersies(versieInfo.versie, "1.1.0");
        if (heeftNieuweVersie) {
          document.getElementById('update-banner').classList.add('show');
        }
      } catch (error) {
        console.error('Fout bij versie check:', error);
        updateOfflineStatus();
        
        // Toon foutmelding
        if (!isOnline()) {
          toonFoutmelding('Je bent offline. Laatste bekende versie wordt getoond.');
        } else {
          toonFoutmelding('Kon versie-informatie niet ophalen. Controleer je internetverbinding.');
        }

        // Probeer gecachede versie te tonen
        const gecachedeVersie = localStorage.getItem(CONFIG.storage.laatsteVersie);
        if (gecachedeVersie) {
          const versieInfo = JSON.parse(gecachedeVersie);
          document.getElementById('current-version').textContent = versieInfo.versie;
        }
      }
    }

    // Verbeterde changelog weergave
    async function toonChangelog() {
      const modal = document.getElementById('changelog-modal');
      const content = document.getElementById('changelog-content');
      
      modal.classList.add('show');
      content.innerHTML = '<div class="changelog-loading"><span class="material-icons" style="margin-right: 0.5rem;">hourglass_empty</span>Laden...</div>';
      
      try {
        const changelogText = await haalChangelogOp();
        
        if (!changelogText) {
          content.innerHTML = `
            <div class="changelog-error">
              <span class="material-icons" style="margin-right: 0.5rem;">error_outline</span>
              Kon de wijzigingsgeschiedenis niet laden. Probeer het later opnieuw.
            </div>
          `;
          return;
        }
        
        // Parse Markdown en formatteer
        let html = '';
        
        // Splits op versies (## [x.x.x])
        const versies = changelogText.split(/^## \[/gm).filter(s => s.trim());
        
        versies.forEach((versie, index) => {
          if (!versie) return;
          
          // Extract versie nummer en datum
          const versieMatch = versie.match(/^([0-9.]+)\]\s*-\s*([0-9-]+)/);
          if (!versieMatch) return;
          
          const versieNummer = versieMatch[1];
          const versieDatum = versieMatch[2];
          const isNieuw = index === 0; // Eerste versie is de nieuwste
          
          // Extract de rest van de content
          let versieContent = versie.substring(versie.indexOf('\n'));
          
          // Converteer headers en lijsten
          versieContent = versieContent
            .replace(/^### (.*$)/gm, '<h3>$1</h3>')
            .replace(/^- (.*$)/gm, '<li>$1</li>')
            .replace(/^  - (.*$)/gm, '<li style="margin-left:1.5rem">$1</li>')
            .replace(/\n\n/g, '<br>');
          
          // Voeg de versie toe aan de HTML
          html += `
            <div class="changelog-versie">
              <div class="changelog-header">
                <span>Versie ${versieNummer} - ${versieDatum}</span>
                ${isNieuw ? '<span class="nieuw-badge">Nieuw</span>' : ''}
              </div>
              <div class="changelog-body">
                ${versieContent}
              </div>
            </div>
          `;
        });
        
        content.innerHTML = html || 'Geen wijzigingsgeschiedenis beschikbaar.';
      } catch (error) {
        console.error('Fout bij tonen changelog:', error);
        content.innerHTML = `
          <div class="changelog-error">
            <span class="material-icons" style="margin-right: 0.5rem;">error_outline</span>
            Er is een fout opgetreden bij het laden van de wijzigingsgeschiedenis.
          </div>
        `;
      }
    }

    // Event listeners toevoegen
    document.addEventListener('DOMContentLoaded', function() {
      // Voeg offline indicator toe aan notificaties container
      const notificatiesContainer = document.querySelector('.notifications-container');
      if (notificatiesContainer) {
        const offlineIndicator = document.createElement('div');
        offlineIndicator.className = 'offline-indicator';
        offlineIndicator.innerHTML = `
          <span class="material-icons">cloud_off</span>
          <span>Je bent offline. Sommige functies zijn mogelijk beperkt beschikbaar.</span>
        `;
        notificatiesContainer.appendChild(offlineIndicator);
      }
      
      // Controleer eerst netwerk status
      updateOfflineStatus();
      
      // Controleer dan op updates
      checkVoorUpdates();
      
      // Verwijder oude elementen
      const oudeVersieElements = document.querySelectorAll('.version-info, .version-badge[style*="position: absolute"]');
      oudeVersieElements.forEach(el => el.remove());
      
      // Voeg event listeners toe voor online/offline detectie
      window.addEventListener('online', function() {
        updateOfflineStatus();
        checkVoorUpdates(true); // Force check bij online gaan
        showNotification('Je bent weer online.', 'success', 3000);
      });
      
      window.addEventListener('offline', function() {
        updateOfflineStatus();
        showNotification('Je bent offline. Wijzigingen worden lokaal opgeslagen.', 'warning', 5000);
      });
      
      // Periodieke check op updates
      setInterval(function() {
        if (isOnline()) {
          checkVoorUpdates();
        }
      }, CONFIG.checkInterval);
    });
  </script>
</body>
</html>




